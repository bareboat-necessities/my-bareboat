<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="description" content="Bareboat Necessities, Wave Height from IMU accelerometer">
<meta name="author" content="mgrouch">
<title>Estimating wave height from IMU accelerometer on a moving boat (Early Draft)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<h1>Estimating wave height from IMU accelerometer on a moving boat (Early Draft)</h1>
<div class="details">
<span id="author" class="author">mgrouch</span><br>
<span id="email" class="email"><a href="mailto:mgrouch@users.noreply.github.com">mgrouch@users.noreply.github.com</a></span><br>
<span id="revnumber">version 2024-08-06,</span>
<span id="revdate">Wave Height from IMU accelerometer</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_abstract">1. Abstract</a></li>
<li><a href="#_trochoidal_waves">2. Trochoidal Waves</a>
<ul class="sectlevel2">
<li><a href="#_doppler_effect">2.1. Doppler effect</a></li>
</ul>
</li>
<li><a href="#_trigonometry_of_a_boat_movement">3. Trigonometry of a boat movement</a>
<ul class="sectlevel2">
<li><a href="#_terminology">3.1. Terminology</a></li>
<li><a href="#_calculating_true_wind_and_speed_through_water_based_on_difference_in_heading_and_course_over_ground">3.2. Calculating true wind and speed through water based on difference in heading and course over ground</a></li>
<li><a href="#_heading_true_from_magnetic">3.3. Heading True from Magnetic</a></li>
<li><a href="#_leeway">3.4. Leeway</a></li>
</ul>
</li>
<li><a href="#_imu">4. IMU</a>
<ul class="sectlevel2">
<li><a href="#_getting_vertical_acceleration_from_imu">4.1. Getting vertical acceleration from IMU</a></li>
<li><a href="#_ahrs_attitude_and_heading_reference_system_fusion_algorithms">4.2. AHRS (attitude and heading reference system) fusion algorithms</a></li>
</ul>
</li>
<li><a href="#_kalman_filter_to_double_integrate_vertical_acceleration_into_displacement_without_integration_drift">5. Kalman filter to double integrate vertical acceleration into displacement without integration drift</a>
<ul class="sectlevel2">
<li><a href="#_fft_to_calculate_observed_frequency_of_waves">5.1. FFT to calculate observed frequency of waves</a></li>
<li><a href="#_butterworth_low_pass_filter">5.2. Butterworth Low Pass filter</a></li>
<li><a href="#_aranovskiy_on_line_frequency_estimator">5.3. Aranovskiy on-line frequency estimator</a></li>
</ul>
</li>
<li><a href="#_on_measuring_wave_direction">6. On measuring wave direction</a></li>
<li><a href="#_measuring_wave_height_from_a_moving_boat">7. Measuring wave height from a moving boat</a>
<ul class="sectlevel2">
<li><a href="#_measurable_input_parameters">7.1. Measurable input parameters</a></li>
<li><a href="#_assumptions">7.2. Assumptions</a></li>
<li><a href="#_algorithm_steps">7.3. Algorithm steps</a></li>
<li><a href="#_input_validation">7.4. Input validation</a></li>
<li><a href="#_result_validation">7.5. Result validation</a></li>
</ul>
</li>
<li><a href="#_further_ideas">8. Further ideas</a></li>
<li><a href="#_references">9. References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#8203;<br></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/bareboat-necessities-logo.svg" alt="Bareboat Necessities Logo">
</div>
</div>
<div class="paragraph">
<p>&#8203;<br></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_abstract">1. Abstract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Usual methods for measuring elevation built-in into modern smartwatches and smart devices are based on fusion of data
(using Kalman filters, etc) from IMU (accelerometer) and barometer sensors. These methods are designed to measure steps up and down stairs,
hiking activities, and so on. However, using pressure as a useful source of elevation data is not suitable to measure
the wave height from a boat. The surface of the wave itself (at least in trochoidal wave model) is the surface of
equal pressure. Real waves are more complicated but nevertheless measuring air pressure on their surface
to estimate amplitude of the wave would lead to measuring mostly noise.</p>
</div>
<div class="paragraph">
<p>Calculating elevation (displacement) using double integration of the acceleration leads
to huge result drift due to not knowing initial displacement, initial vertical velocity
and due to signal noise and accelerometer bias.</p>
</div>
<div class="paragraph">
<p>This article describes two different methods to estimate wave height, frequency, period
from a moving boat using IMU (accelerometer) and other common boat sensors such as anemometer (wind), GPS, and compass.
One method is based on Kalman method which calculates second integral of acceleration with a drift correction
based on the fact that in wave average displacement equals to zero. Another method doesn&#8217;t use
integration at all. Instead, it measures max/min acceleration and assumes wave shape to be trochoidal.
Based on max/min acceleration and observed wave frequency (later adjusted using Doppler effect formulas)
the method recreates parameters of the trochoid wave allowing it to estimate the wave height.</p>
</div>
<div class="paragraph">
<p>Initial velocity and position for Kalman filter are taken as estimates from trochoidal model to
allow Kalman filter to converge faster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trochoidal_waves">2. Trochoidal Waves</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gravitational &#160; \$g\$ &#160; (m/s^2): &#160;&#160;&#160;
\$g = 9.81\$</p>
</div>
<div class="paragraph">
<p>Rotation center of trochoidal wave particle in Z axis (always negative) (m): &#160;&#160;&#160;
\$b\$</p>
</div>
<div class="paragraph">
<p>Wavelength (m): &#160;&#160;&#160;
\$L\$</p>
</div>
<div class="paragraph">
<p>Wave equation:</p>
</div>
<div class="paragraph">
<p>\$X(t) = H sin(k c t)\$</p>
</div>
<div class="paragraph">
<p>\$Z(t) = - H cos(k c t)\$</p>
</div>
<div class="paragraph">
<p>Wavenumber (1/m): &#160;&#160;&#160;
\$k = (2 pi) / L\$</p>
</div>
<div class="paragraph">
<p>Wave amplitude (m):  &#160;&#160;&#160;
\$H = e ^(k b) / k = L / (2 pi) e ^ ((2 pi b) / L)  \$ &#160;&#160;&#160; &#8658; &#160;&#160;&#160;
\$b = ln(H k) / k = L / (2 pi) ln ((2 pi H) / L)  \$</p>
</div>
<div class="paragraph">
<p>max(H) amplitude (m):   &#160;&#160;&#160;  \$H_max = L / (2 pi)\$ &#160;&#160;&#160; when &#160; b = 0</p>
</div>
<div class="paragraph">
<p>Depth (m): &#160;&#160;&#160;
\$d\$</p>
</div>
<div class="paragraph">
<p>Wave speed (m/s): &#160;&#160;&#160;
\$c = sqrt(g / k tanh(k d))\$ &#160;,&#160;&#160;&#160;&#160;&#160;
for deep water waves: \$c = sqrt(g / k) = sqrt((g L) / (2 pi))\$,  &#160;&#160; \$L = (g T ^ 2) / (2 pi)\$</p>
</div>
<div class="paragraph">
<p>Wave period (s):   &#160;&#160;&#160;
\$T = L / c\$</p>
</div>
<div class="paragraph">
<p>Wave frequency (Hz=1/s):   &#160;&#160;&#160;
\$f = 1 / T = c / L\$</p>
</div>
<div class="paragraph">
<p>Vertical motion is harmonic.</p>
</div>
<div class="paragraph">
<p>Vertical displacement:
\$Z(t) = - H cos(k c t) = - L / (2 pi) (a(t))/g\$</p>
</div>
<div class="paragraph">
<p>Vertical velocity:
\$u(t) = Z^'(t) = k c H sin(k c t) = c e ^ ((2 pi b) / L) sin(k c t)\$</p>
</div>
<div class="paragraph">
<p>\$u_max = c e ^ ((2 pi b) / L)\$</p>
</div>
<div class="paragraph">
<p>\$u_max(b=0) = c\$</p>
</div>
<div class="paragraph">
<p>Vertical acceleration:
\$a(t) = u^'(t) = k^2 c^2 H cos(k c t) = g e ^ ((2 pi b) / L) cos(k c t)\$</p>
</div>
<div class="paragraph">
<p>\$a_max = -a_min = k^2 c^2 H =  ((2 pi) / L) ^ 2 ((g L) / (2 pi)) L / (2 pi) e^((2 pi b)/L) = g e^((2 pi b)/L)  \$</p>
</div>
<div class="paragraph">
<p>\$b = L / (2 pi) ln(a_max / g)\$</p>
</div>
<div class="paragraph">
<p>Slope \$s(t)\$:</p>
</div>
<div class="paragraph">
<p>\$x_b(t) = X(t) - t Delta v\$</p>
</div>
<div class="paragraph">
<p>\$s(t) = d/ (dx_b) ((Z(t)) / (x_b(t))) =  (d/dt(Z)) / (d/dt(x_b)) = (d/dt(- H cos(kct))) / (d/dt(H sin(kct) - t Delta v)) = (cHk sin(kct)) / (cHk cos(kct) - Delta v)\$</p>
</div>
<div class="sect2">
<h3 id="_doppler_effect">2.1. Doppler effect</h3>
<div class="paragraph">
<p>\$f\$ &#160; is emitted frequency (Hz=1/s),</p>
</div>
<div class="paragraph">
<p>\$f_o\$ &#160; is observed frequency (Hz=1/s):</p>
</div>
<div class="paragraph">
<p>\$c\$ &#160; is the propagation speed of waves in the medium</p>
</div>
<div class="paragraph">
<p>\$Delta v\$ &#160; is the opposite of the velocity of the receiver
relative to the source: it is positive when the source and the receiver are moving towards each other.</p>
</div>
<div class="paragraph">
<p>\$f_o = (c +- Delta v) / c f\$</p>
</div>
<div class="paragraph">
<p>\$L\$ &#160; is source wavelength (m) for trochoidal wave.</p>
</div>
<div class="paragraph">
<p>For trochoidal wave:</p>
</div>
<div class="paragraph">
<p>\$f = c / L\$ &#160; &#8658; &#160; \$f_o = (c +- Delta v) / L \$,</p>
</div>
<div class="paragraph">
<p>\$c = sqrt((g L) / (2 pi))\$ &#160; &#8658; &#160; \$f_0 = (sqrt((g L) / (2 pi)) +- Delta v) / L\$</p>
</div>
<div class="paragraph">
<p>\$L = (sign(Delta v) sqrt(8 pi f_o g  Delta v + g ^ 2) + 4 pi f_o  Delta v + g) / (4 pi f_o ^ 2)\$</p>
</div>
<div class="paragraph">
<p>Apparent (observed) vertical acceleration:</p>
</div>
<div class="paragraph">
<p>\$a_(observed)(Delta v, t) = d^2/dt^2 (- H cos(k (c + Delta v) t)) = H k^2 (c^2 + 2 c Delta v + (Delta v)^2) cos(k (c + Delta v) t)\$</p>
</div>
<div class="paragraph">
<p>\$a_(observed_max) = H k^2 (c^2 + 2 c Delta v + (Delta v)^2)\$ &#8658;</p>
</div>
<div class="paragraph">
<p>\$H = H(L, Delta v) = a_(observed_max) / (k^2 (c^2 + 2 c Delta v + (Delta v)^2)) \$</p>
</div>
<div class="paragraph">
<p>\$a_max = a_(observed_max) c^2 / (c^2 + 2 c Delta v + (Delta v)^2)\$</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trigonometry_of_a_boat_movement">3. Trigonometry of a boat movement</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_terminology">3.1. Terminology</h3>
<div class="paragraph">
<p><em>AWS</em> &#160; is Apparent Wind Speed (relative to the boat heading)</p>
</div>
<div class="paragraph">
<p><em>AWA</em> &#160; is Apparent Wind Angle (relative to the bow heading, 0 to 180, starboard plus, port minus)</p>
</div>
<div class="paragraph">
<p><em>AWD</em> &#160; is Apparent Wind Direction (relative to true north)</p>
</div>
<div class="paragraph">
<p><em>AGWS</em> &#160; is Apparent Ground Wind Speed (relative to the boat course over the ground)</p>
</div>
<div class="paragraph">
<p><em>AGWA</em> &#160; is Apparent Ground Wind Angle (relative to the boat course over the ground, 0 to 180, starboard plus, port minus)</p>
</div>
<div class="paragraph">
<p><em>AGWD</em> &#160; is Apparent Ground Wind Direction (relative to true north)</p>
</div>
<div class="paragraph">
<p><em>SPD</em> &#160; is Knotmeter speed (relative to the water)</p>
</div>
<div class="paragraph">
<p><em>HDT</em> &#160; is Heading true (relative to true north)</p>
</div>
<div class="paragraph">
<p><em>HDM</em> &#160; is  Heading magnetic (relative to magnetic north)</p>
</div>
<div class="paragraph">
<p><em>DFT</em> &#160; is  Current Drift (speed of current, relative to fixed earth)</p>
</div>
<div class="paragraph">
<p><em>SET</em> &#160; is  Current Set (direction current flows toward relative to fixed earth true north)</p>
</div>
<div class="paragraph">
<p><em>SOG</em> &#160; is  Speed Over Ground (relative to the fixed earth)</p>
</div>
<div class="paragraph">
<p><em>COGT</em> &#160; is Course Over Ground true (relative to the fixed earth true north)</p>
</div>
<div class="paragraph">
<p><em>COGM</em> &#160; is Course Over Ground magnetic (relative to the fixed earth magnetic north)</p>
</div>
<div class="paragraph">
<p><em>GWS</em> &#160; is Ground Wind Speed (relative to the fixed earth)</p>
</div>
<div class="paragraph">
<p><em>GWD</em> &#160; is Ground Wind Direction (relative to true north)</p>
</div>
<div class="paragraph">
<p><em>TWA</em> &#160; is True Wind Angle (relative to the heading, 0 = upwind, 180deg = downwind, (+ starboard, - port))</p>
</div>
<div class="paragraph">
<p><em>TWS</em> &#160; is True Wind Speed (relative to the water)</p>
</div>
<div class="paragraph">
<p><em>TWD</em> &#160; is True Wind Direction (relative to true north)</p>
</div>
<div class="paragraph">
<p><em>POS</em> &#160; is position LAT, LON (latitude, longitude)</p>
</div>
<div class="paragraph">
<p><em>TB(POS1, POS2)</em> &#160; is Bearing true (true north angle to maintain in course to reach from POS1 to POS2)</p>
</div>
</div>
<div class="sect2">
<h3 id="_calculating_true_wind_and_speed_through_water_based_on_difference_in_heading_and_course_over_ground">3.2. Calculating true wind and speed through water based on difference in heading and course over ground</h3>
<div class="paragraph">
<p>Having both true heading and true course over the ground allows calculating true wind vector parameters and
speed through the water (SPD):</p>
</div>
<div class="paragraph">
<p>\$SPD = ((dist(POS2, POS1)) / (t_\text{end} - t_\text{start}) - DFT * cos(COGT - SET)) * cos(COGT - avg(HDT))\$</p>
</div>
<div class="paragraph">
<p>\$TWS = sqrt((avg(AWS)) ^ 2 + SPD ^ 2 - 2 * avg(AWS) * SPD * cos(avg(AWA)))\$</p>
</div>
<div class="paragraph">
<p>\$TWA = +- arccos((avg(AWS) * cos(avg(AWA)) - SPD) / (TWS))\$</p>
</div>
<div class="paragraph">
<p>For Doppler effect formulas:</p>
</div>
<div class="paragraph">
<p>\$Delta v = SPD * cos(TWA)\$</p>
</div>
</div>
<div class="sect2">
<h3 id="_heading_true_from_magnetic">3.3. Heading True from Magnetic</h3>
<div class="paragraph">
<p>IMU helps measuring magnetic heading HDM. To calculate true heading, it is required to have
Earth magnetic model and using location and time it gives you magnetic variation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import wmm2020

yeardec = datetime.date.today().year
alt_km = 0
declination = wmm2020.wmm(glat, glon, alt_km, yeardec).decl</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_leeway">3.4. Leeway</h3>
<div class="paragraph">
<p>Although leeway calculation is not required for the algorithm (it gets taken into account with using
heading to course over ground difference), for completeness, here is the popular empirical formula:</p>
</div>
<div class="paragraph">
<p>Leeway (deg) is angle to adjust heading to maintain constant COG (assuming no current)</p>
</div>
<div class="paragraph">
<p>\$\l\eeway = heel  K / (SPD ^ 2)\$</p>
</div>
<div class="paragraph">
<p>\$heel\$ &#160;&#160; is boat heel and needs to be in (degrees) for the formula above</p>
</div>
<div class="paragraph">
<p>\$SPD\$  &#160;is speed through water  and needs to be in (kt)</p>
</div>
<div class="paragraph">
<p>\$K\$ &#160;&#160;&#160;&#160;&#160; is boat and boat load specific constant (kt^2), about 10.0</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_imu">4. IMU</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_getting_vertical_acceleration_from_imu">4.1. Getting vertical acceleration from IMU</h3>
<div class="paragraph">
<p>Most IMU libraries provide a way to get the attitude quaternion \$q\$.
Using this quaternion to get acceleration in Earth XYZ from IMU frame xyz: \$\text{accel} = (a_x, a_y, a_z)\$ vector,
the quaternion \$q\$ is used to rotate vector \$\text{accel}\$</p>
</div>
<div class="paragraph">
<p>\$\text{accel}_\text{earthXYZ} = q * \text{accel} * q'\$</p>
</div>
<div class="paragraph">
<p>where \$q'\$ is inverted quaternion \$q\$.</p>
</div>
<div class="paragraph">
<p>The same quaternion can be used to get Euler angles of pitch, roll and yaw.
Yaw would correspond to the magnetic heading.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To estimate max acceleration it&#8217;s not needed to extract vertical part of acceleration.
Just magnitude of acceleration \$a=sqrt(a_x^2 + a_y^2 + a_z^2)\$ should be sufficient.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ahrs_attitude_and_heading_reference_system_fusion_algorithms">4.2. AHRS (attitude and heading reference system) fusion algorithms</h3>
<div class="paragraph">
<p>If quaternion from IMU is not available, then it can be calculated using AHRS fusion algorithms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Madgwick algorithm</p>
</li>
<li>
<p>Mahony algorithm</p>
</li>
<li>
<p>RTQF quaternion fusion for lower power processors</p>
</li>
<li>
<p>Extended Kalman Filter (EKF)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kalman_filter_to_double_integrate_vertical_acceleration_into_displacement_without_integration_drift">5. Kalman filter to double integrate vertical acceleration into displacement without integration drift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ref:</p>
</div>
<div class="paragraph">
<p>Sharkh S. M., Hendijanizadeh2 M., Moshrefi-Torbati3 M., Abusara M. A.:
A Novel Kalman Filter Based Technique for
Calculating the Time History of Vertical
Displacement of a Boat from Measured
Acceleration,
Marine Engineering Frontiers (MEF) Volume 2, 2014</p>
</div>
<div class="paragraph">
<p>The method uses assumption that average vertical displacement is zero. So it takes third integral of acceleration
as input measurement with zero value. Vertical acceleration on each step is the value used in transition offset.</p>
</div>
<div class="paragraph">
<p>So only input observation value is 0 (third integral of acceleration).
Acceleration used in transition offset needs to exclude Earth gravitational g and accelerometer bias.
So avg(acceleration) is subtracted from it.</p>
</div>
<div class="paragraph">
<p>Accelerometer noise will make the filter to converge slower.
Accelerometer bias will skew the displacement on one side.
Giving too low covariances will flatten the result too much. Too high covariances will make it jump too much.</p>
</div>
<div class="paragraph">
<p>Low pass filter is needed to get rid of high frequency noise before running this filter to get better results.</p>
</div>
<div class="paragraph">
<p>Kalman method parameters.</p>
</div>
<div class="paragraph">
<p>Transition matrix:</p>
</div>
<div class="paragraph">
<p>\$ F = [[1, dt, 1/2 dt ^ 2 ], [0,  1,       dt], [0,  0,        1]]  \$</p>
</div>
<div class="paragraph">
<p>Transition offset:</p>
</div>
<div class="paragraph">
<p>\$ B = ( (1/6 dt^3), (1/2 dt^2), (dt) ) \$</p>
</div>
<div class="paragraph">
<p>Observation matrix:</p>
</div>
<div class="paragraph">
<p>\$ H = (1, 0, 0) \$</p>
</div>
<div class="paragraph">
<p>Transition covariance:</p>
</div>
<div class="paragraph">
<p>\$ Q = [[ \text{PosIntegral_Trans_Variance}, 0, 0 ], [0, \text{Pos_Trans_Variance}, 0 ], [0, 0, \text{Vel_Trans_Variance} ]] \$</p>
</div>
<div class="paragraph">
<p>Observation covariance:</p>
</div>
<div class="paragraph">
<p>\$ R = [[ \text{PosIntegral_Variance} ]] \$</p>
</div>
<div class="paragraph">
<p>Initial state mean (height integral, height, velocity):</p>
</div>
<div class="paragraph">
<p>\$ X0 = ((0), (\text{height_from_trochoid_model}), (\text{velocity_from_trochoid_model})) \$</p>
</div>
<div class="paragraph">
<p>Initial state covariance:</p>
</div>
<div class="paragraph">
<p>\$ P0 = [[ \text{PosIntegral_Variance}, 0, 0], [0, 1, 0], [0, 0, 1]] \$</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from pykalman import KalmanFilter
import numpy as np

kf = KalmanFilter(transition_matrices=F,
                  observation_matrices=H,
                  transition_covariance=Q,
                  observation_covariance=R,
                  initial_state_mean=X0,
                  initial_state_covariance=P0)

for t in range(n_timesteps):
    if t == 0:
        filtered_state_means[t] = X0
        filtered_state_covariances[t] = P0
    else:
        observation = 0
        transition_offset = B * (accZ_val[t] - acc_avg)
        filtered_state_means[t], filtered_state_covariances[t] = (
            kf.filter_update(
                filtered_state_mean = filtered_state_means[t-1],
                filtered_state_covariance = filtered_state_covariances[t-1],
                transition_offset = transition_offset,
                observation = observation
            )
        )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The wave height needs to be evaluated based on the results on the end side of the sampling interval.
The results in the beginning of the sample interval will have extra spikes due to Kalman
filter taking time to converge (without knowing initial velocity and position and adjusting
covariances).</p>
</div>
<div class="sect2">
<h3 id="_fft_to_calculate_observed_frequency_of_waves">5.1. FFT to calculate observed frequency of waves</h3>
<div class="paragraph">
<p>Fast (discrete) Fourier Transform (FFT) is used to find main frequency (the one which carries most energy) of the waves.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import numpy as np
from scipy import fft

SAMPLE_RATE = 1.0 / dt
N_SAMP = n_timesteps

w = fft.rfft(accZ_val)
freqs = fft.rfftfreq(N_SAMP, 1 / SAMPLE_RATE)

# Find the peak in the coefficients
idx = np.argmax(np.divide(np.divide(np.abs(w), freqs), freqs))
freq = freqs[idx]
freq_in_hertz = abs(freq)
period = 1 / freq_in_hertz</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_butterworth_low_pass_filter">5.2. Butterworth Low Pass filter</h3>
<div class="paragraph">
<p>Butterworth Low pass filter is used to filter out high frequencies noise in input
to Kalman filter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import numpy as np
from scipy import signal

sos = signal.butter(2, freq_in_hertz * 8, 'low', fs=SAMPLE_RATE, output='sos')
low_pass_filtered = signal.sosfilt(sos, accZ_val)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aranovskiy_on_line_frequency_estimator">5.3. Aranovskiy on-line frequency estimator</h3>
<div class="paragraph">
<p>Instead of FFT method for finding main wave frequency we could use Aranovskiy frequency estimator which is
a simple on-line filter.</p>
</div>
<div class="paragraph">
<p>Ref:</p>
</div>
<div class="paragraph">
<p>Alexey A. Bobtsov, Nikolay A. Nikolaev, Olga V. Slita, Alexander S. Borgul, Stanislav V. Aranovskiy</p>
</div>
<div class="paragraph">
<p>The New Algorithm of Sinusoidal Signal Frequency Estimation.</p>
</div>
<div class="paragraph">
<p>11th IFAC International Workshop on
Adaptation and Learning in Control and Signal Processing
July 3-5, 2013. Caen, France</p>
</div>
<div class="paragraph">
<p><a href="https://www.sciencedirect.com/science/article/pii/S1474667016329421">The New Algorithm of Sinusoidal Signal Frequency Estimation</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from math import sin, sqrt
import matplotlib.pyplot as plt
import numpy as np

# initialize algorithm constants

omega_up = 0.0  # upper frequency
a = 1.0
b = 1.0
k = 1.0
theta_0 = - omega_up * omega_up / 4.0
x1_0 = 0.0
sigma_0 = theta_0

delta_t = 0.001  # time step
count = 30000  # iterations


def func_y(t):
    return 2.0 * sin(2.0 * t)


# initialize variables
t = 0.0
x1 = x1_0
theta = theta_0
sigma = sigma_0

chart_x = np.zeros(count)
chart_y = np.zeros(count)


# loop
for n in range(0, count):
    # step
    y = func_y(t)
    x1_dot = - a * x1 + b * y
    sigma_dot = - k * x1 * x1 * theta - k * a * x1 * x1_dot - k * b * x1_dot * y
    theta = sigma + k * b * x1 * y
    omega = sqrt(abs(theta))

    print(omega)
    chart_x[n] = t
    chart_y[n] = omega

    x1 = x1 + x1_dot * delta_t
    sigma = sigma + sigma_dot * delta_t
    t = t + delta_t


plt.plot(chart_x, chart_y)
plt.grid()
plt.show()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_on_measuring_wave_direction">6. On measuring wave direction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Measuring wave direction can be achieved by using multiple accelerometers mounted in different locations on a ship.</p>
</div>
<div class="paragraph">
<p>Ref:</p>
</div>
<div class="paragraph">
<p>Ocean Engineering
Volume 249, 1 April 2022, 110760</p>
</div>
<div class="paragraph">
<p>Johann A. Dirdala, Roger Skjetneb, Jan Roháčc, Thor I. Fossen</p>
</div>
<div class="paragraph">
<p>Online wave direction and wave number estimation from surface vessel motions using distributed
inertial measurement arrays and phase-time-path-differences</p>
</div>
<div class="paragraph">
<p><a href="https://www.sciencedirect.com/science/article/pii/S0029801822002098" class="bare">https://www.sciencedirect.com/science/article/pii/S0029801822002098</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_measuring_wave_height_from_a_moving_boat">7. Measuring wave height from a moving boat</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_measurable_input_parameters">7.1. Measurable input parameters</h3>
<div class="paragraph">
<p>Open sea waves have periods 20 sec or even longer. So sample duration time
should be in minutes to capture several waves. Playing with reference data without noise
shows described Kalman algorithm needs about 10 wavelength to converge accurately.
So with longer way samples needs to be longer. 5-15 mins.</p>
</div>
<div class="paragraph">
<p>Acceleration positive &#8658; position negative. They are in counter phase. This could allow setting initial position for Kalman filter better.</p>
</div>
<div class="paragraph">
<p>Pitch negative &#8658; speed vector is pointing down. This could also allow setting initial velocity for Kalman filter better.</p>
</div>
<div class="paragraph">
<p>So for initial position and speed in Kalman filter:</p>
</div>
<div class="paragraph">
<p>\$pos_\text{init} = - a_\text{init} / (k^2 c^2) = - a_\text{init} / (g k) = - L a_\text{init} / (2 pi g) \$</p>
</div>
<div class="paragraph">
<p>\$tan(\p\i\tch_\text{init}) = const_1 * s_\text{init}(Delta v = 0)\$ &#160;&#160; tangent of pitch is proportional to wave slope</p>
</div>
<div class="paragraph">
<p>\$vel_\text{init} =  kcH cos(kct) * s_\text{init}(Delta v = 0) = (kcH) / (const_1) sin(\p\itch_\text{init}) = const_2 * c * sin(\p\itch_\text{init}) \$,</p>
</div>
<div class="paragraph">
<p>\$const_2\$ to be found empirically (it&#8217;s vessel specific too).</p>
</div>
<div class="paragraph">
<p>Or</p>
</div>
<div class="paragraph">
<p>\$vel_\text{init} = c e^((2 pi b)/L) sin (arccos (a_\text{init} / g e^(-(2 pi b)/ L))) * sign(\p\itch_\text{init}) \$</p>
</div>
<div class="ulist">
<ul>
<li>
<p>t_start, t_end - time interval of measurements (about 5 mins)</p>
</li>
<li>
<p>POS(t) as LAT(t), LON(t)</p>
</li>
<li>
<p>AWA(t) AWS(t)</p>
</li>
<li>
<p>COG(t) SOG(t)</p>
</li>
<li>
<p>HDM(t) + mag_variation &#8594; HDT(t)</p>
</li>
<li>
<p>DFT(t) SET(t) - (possibly from current/tide stations harmonics data)</p>
</li>
<li>
<p>heel(t), pitch(t)</p>
</li>
<li>
<p>SPD(t) - possibly (might be missing) &#8658; leeway(heel(t), SPD(t))</p>
</li>
<li>
<p>accel(t, x, y, z), vertical_accel(t) via pitch,roll,yaw</p>
</li>
<li>
<p>ROT(t) - rate of turn</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_assumptions">7.2. Assumptions</h3>
<div class="ulist">
<ul>
<li>
<p>No tacks, jibes during sample</p>
</li>
<li>
<p>Heading and course over ground are mostly steady</p>
</li>
<li>
<p>Wind is not changing drastically</p>
</li>
<li>
<p>Depth is deep, i.e. depth &gt; 1/2 wavelength</p>
</li>
<li>
<p>Water current is not changing much (or zero i.e. negligible relative to boat speed)</p>
</li>
<li>
<p>Trochoidal wave model</p>
</li>
<li>
<p>Wave length is longer than boat length</p>
</li>
<li>
<p>Approx formula for b, H (in trochoidal wave model)</p>
</li>
<li>
<p>Accelerometer installed near vessel&#8217;s center of mass (center of buoyancy)</p>
</li>
<li>
<p>Vessel&#8217;s geometry and RAO (Response amplitude operator) is not taken into account</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_algorithm_steps">7.3. Algorithm steps</h3>
<div class="paragraph">
<p>Calculation steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FFT to get observed wave frequency from acceleration (f_observed)</p>
</li>
<li>
<p>Speed toward wave fronts (delta_v for Doppler frequency) from wind and speed data</p>
<div class="ulist">
<ul>
<li>
<p>COGT as true bearing from POS1 to POS2</p>
</li>
<li>
<p>Convert HDM to HDT using position and local mag declination, Use avg(HDT) vs COG and coordinates to calculate SPD</p>
</li>
<li>
<p>SPD = (DIST(POS1, POS2)/(t_end - t_start) - (DFT * cos(COGT - SET))) * cos(COGT - avg(HDT))</p>
</li>
<li>
<p>avg(leeway(heel(t), SPD))</p>
</li>
<li>
<p>use avg(AWA), AVG(AWS) and SPD to calculate TWS/TWA</p>
</li>
<li>
<p>TWS = sqrt(AVG(AWS) ^ 2 + SPD ^ 2 - 2 * AVG(AWS) * SPD * cos(avg(AWA)))</p>
</li>
<li>
<p>TWA = +- arccos( ( AVG(AWS) * cos(avg(AWA)) - SPD ) / TWS)</p>
</li>
<li>
<p>calculate delta_v as SPD * cos(TWA)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Calculate L_source (source wave length) for trochoidal wave model from f_observed and delta_v using Doppler formulas</p>
</li>
<li>
<p>Low pass filter for accel data</p>
</li>
<li>
<p>min/max accel after low pass</p>
</li>
<li>
<p>Calculate b value for trochoidal wave model from known L_source and min/max accel after low pass</p>
</li>
<li>
<p>Calculate wave height from b and L_source</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_input_validation">7.4. Input validation</h3>
<div class="ulist">
<ul>
<li>
<p>Validate heading and COG for steadiness</p>
</li>
<li>
<p>Validate that magnetic variation is known for the position</p>
</li>
<li>
<p>Check validity of accel (against g)</p>
</li>
<li>
<p>Validate input data against assumptions</p>
</li>
<li>
<p>Discard the sample if it is not good and start collecting a new one.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_result_validation">7.5. Result validation</h3>
<div class="ulist">
<ul>
<li>
<p>Validate wave amplitude max &#160; \$H &lt; H_max = L / (2 pi)\$</p>
</li>
<li>
<p>Validate accel (Ratio to \$g\$ can&#8217;t be unreasonably high)</p>
</li>
<li>
<p>Discard the sample if the result is not good and start collecting a new one.</p>
</li>
<li>
<p>Validate height calculated by Kalman filter against height calculated from max acceleration
and wavelength with trochoidal model.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_ideas">8. Further ideas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Trochoidal model gives a good reference point. It&#8217;s easy to go from acceleration to vertical displacement
in trochoidal model knowing the wavelength. So (I think) it could be a good idea to use trochoidal model estimations
as input to Kalman filter fusion (instead of zero third integral assumption), as another way to prevent
displacement integral of acceleration from drift.</p>
</div>
<div class="paragraph">
<p>Vertical velocity and heel are correlated. It would be interesting to study their interdependencies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">9. References</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sharkh S. M., Hendijanizadeh2 M., Moshrefi-Torbati3 M., Abusara M. A.: A Novel Kalman Filter Based Technique for Calculating the Time History of Vertical Displacement of a Boat from Measured Acceleration, <a href="https://www.researchgate.net/profile/Mehdi-Hendijanizadeh/publication/264713649_A_Novel_Kalman_Filter_Based_Technique_for_Calculating_the_Time_History_of_Vertical_Displacement_of_a_Boat_from_Measured_Acceleration/links/53ec88db0cf24f241f1584c5/A-Novel-Kalman-Filter-Based-Technique-for-Calculating-the-Time-History-of-Vertical-Displacement-of-a-Boat-from-Measured-Acceleration.pdf">Marine Engineering Frontiers (MEF) Volume 2, 2014</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Trochoidal_wave">Trochoidal Wave Wikipedia</a></p>
</li>
<li>
<p>Alexey A. Bobtsov, Nikolay A. Nikolaev, Olga V. Slita, Alexander S. Borgul, Stanislav V. Aranovskiy: The New Algorithm of Sinusoidal Signal Frequency Estimation. 11th IFAC International Workshop on
Adaptation and Learning in Control and Signal Processing
July 3-5, 2013. Caen, France: <a href="https://www.sciencedirect.com/science/article/pii/S1474667016329421">The New Algorithm of Sinusoidal Signal Frequency Estimation</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Wind_wave">Wind Wave Wikipedia</a></p>
</li>
<li>
<p><a href="https://wikiwaves.org/">Wiki Waves</a></p>
</li>
<li>
<p><a href="https://github.com/seandepagnier/RTIMULib2">RTIMULib2 IMU library</a></p>
</li>
<li>
<p><a href="https://github.com/pypilot/pypilot">PyPilot Free Autopilot</a></p>
</li>
<li>
<p><a href="https://github.com/space-physics/wmm2020">World Magnetic Model on GitHub</a></p>
</li>
<li>
<p><a href="https://www.sciencedirect.com/science/article/pii/S0029801822002098">Online wave direction and wave number estimation from surface vessel motions using distributed inertial measurement arrays and phase-time-path-differences</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2024-08-06<br>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>