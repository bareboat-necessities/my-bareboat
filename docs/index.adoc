= Bareboat Necessities Projects
mgrouch <mgrouch@users.noreply.github.com>
{docdate}, Bareboat Projects
:imagesdir: images
:doctype: book
:organization: Bareboat Necessities
:title-logo-image: image:bareboat-necessities-logo.svg[Bareboat Necessities Logo]
ifdef::backend-pdf[]
:source-highlighter: rouge
:toc-placement!: manual
:pdf-page-size: Letter
:plantumlconfig: plantuml.cfg
endif::[]
ifndef::backend-pdf[]
:toc-placement: left
endif::[]
:experimental:
:reproducible:
:toclevels: 4
:sectnums:
:sectnumlevels: 3
:encoding: utf-8
:lang: en
:icons: font
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
:env-github:

{zwsp} +

ifndef::backend-pdf[]

image::bareboat-necessities-logo.svg[Bareboat Necessities Logo]

{zwsp} +

endif::[]

https://bareboat-necessities.github.io

https://github.com/bareboat-necessities/my-bareboat

https://github.com/bareboat-necessities/my-bareboat/issues

https://bareboat-necessities.wixsite.com/my-bareboat

{zwsp} +

toc::[]

== Boat Electronics Project

This document describes a DIY project of building a marine computer, a boat LTE/WiFi gateway, and
a cockpit chartplotter display from easily obtainable and affordable components.
This boat electronics project includes:

* Waterproof marine touch screen HDMI display
* GNSS (GPS, GLONASS, Beidou, Galileo) receiver
* Sensors for orientation (gyroscope, accelerometer, compass via IMU)
* AIS radar
* Environment temperature, barometric pressure, humidity sensors
* Connections to the boat instruments such as wind, depth, speed, AIS via NMEA 0183 serial ports
* Boat LTE / 4G Gateway, network storage
* Boat WiFi hotspot and a router with WiFi extender and a long range waterproof WiFi antenna
* Optional autopilot integration, rudder angle sensor
* Other NMEA devices, engine/battery status, bilge pump monitoring, etc
* Optional air mouse with a wireless keyboard and a touchpad
* Lightning EMI sensor and alarm
* RTL-SDR for weather fax, satellite weather, AIS, RTL 433, morse code decoder, etc
* Boat IoT Integration via MQTT
* Can be used with Iridium Satellite Modems
* Can be used for processing transmissions received from SSB radio via audio interface
* Variety of options of using wireless handheld devices such as smart phones and tablets
to connect to boat systems via WiFi and bluetooth. There are many marine applications available for
smart phones and tablets.

The boat computer is connected to the waterproof HDMI touchscreen in the cockpit.

*Boat Computer*

.Boat Computer
image::computer-front-panel.jpg[alt="Boat Computer Front View", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

*Boat Gateway*

.Boat Gateway
image::boat-router/boat-router.jpg[alt="Boat Gateway Front View", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

NOTE: Keep in mind that by following this document you are building devices to be used in marine environment.
All connections and wiring need to follow marine standards which are more strict than automotive. All nuts and bolts
need to be properly tightened. I've run into issues in my sailboat experience on water just because of
one missing washer  (It was in mechanical system on gear switch wire). Heat shrink tubing, wire grades are different
for marine standards. Corrosion in misty salt water air is much higher than on the ground. A boat is exposed
to the elements more than house or automobile appliances. If you doubt you did something right you better of
revisiting it or seeking peer review from  other sailors. The same works the other way. If you see something wrong
here with the design let us know :) There is issues reporting system in GitHub:
https://github.com/bareboat-necessities/my-bareboat/issues

NOTE: Although this document describes mostly instructions on building hardware components, it is designed in
the spirit of open source development. We hope this design is going to evolve and have numerous releases and corrections
if it gains some community. Some software components might become part of this project too. Cost cutting is another sport and
sub-hobby in recreational sailing and boating. So if same functionality can be built cheaper it probably should be, and
here is the reason to change this document.

=== Boat Computer

The boat computer runs on Raspberry Pi (Raspbian Linux) with OpenPlotter 2.0 installed. The boat computer will reside
below deck so it's not going to be waterproof. The touchscreen display runs OpenPlotter UI with OpenCPN chartplotter
and dashboards as well as general Linux UI.

*The boat computer front panel interfaces:*

* 1 USB 3.0 data port
* 1 AUX audio port
* 1 USB 2.0 data port
* 1 HDMI port
* Computer Voltage Meter
* Amp and Voltage Meter Combined
* Status indicators via fiber-optic light pipes
* Fuse box panel mount
* On/Off power switch
* On/Off power switch for cockpit instruments

{zwsp} +

.Boat Computer, Front Panel
image::front-panel-intf.jpg[alt="Boat Computer, Front Panel", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

*The boat computer back panel interfaces:*

* 1 Ethernet port 1Gbit (for the WiFi router)
* 1 USB 2.0 port for GPS (or something else)
* 1 NMEA-0183 port (More can be added in the same DIY fashion)
* DC power 2-wire input cord mounted inside a waterproof gland for 12v boat connection. SAE-type connector
* DC power 2-wire output cord mounted inside a waterproof gland for 12v cockpit connection. SAE-type connector
(black male)
* HDMI and USB 3.0 connectors to the cockpit display and touchscreen
* RF connector for AIS antenna
* RF connector for RTL-SDR antenna
* SMA RF connector for a secondary GPS

{zwsp} +

.Boat Computer, Back Panel
image::back-panel-intf.jpg[alt="Boat Computer, Back Panel", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

*Boat Computer Inside*

NOTE: Raspberry Pi lays on top of the middle divider made out of plastic sheet. The power supply (12v to 5v step-down
converter) is mounted from the other side under the middle divider. The USB hub doesn't fit by height to simply lay
on the divider, so there is a little shelf made out of the same plastic sheet and it is attached by 4 shortest
standoffs. USB hub is mounted under a slight angle to give space to a screw which closes the enclosure.


.Boat Computer, Inside
image::computer-internals.jpg[alt="Boat Computer, Inside", width="75%", pdfwidth="75vw", align="center"]

{zwsp} +

On the picture above 7-Port powered USB 3.0 hub, dAISy AIS, Raspberry Pi 4 with a cooling fan and heat sinks,
serial-to-USB stick (with the chipset from FTDI), SSD, RTL-SDR RF stick. 12v to 5v step-down converter is
located below this layer inside the housing box and is connected to the front panel via a fuse and
a switch on the front panel.

You can customize the front and back panels for your needs.

==== Basic Schematics

.Boat Computer Basic Schematics Diagram
image::boat-computer.svg[alt="Boat Computer Basic Schematics Diagram"]

{zwsp} +

Raspberry Pi 4 has also WiFi and BlueTooth interfaces:

* 802.11ac/n
* Bluetooth 5.0

WiFi can be used to set up access to the boat computer from smart phones and tablets
with additional software.

==== Tools and Supplies

[cols="5,12,3,4", options="header"]
|===



|Item
|Description
|Cost
|Source


| Standoffs
a| Hilitchi 120Pcs M3 Nylon Hex Spacers Screw Nut Standoff Plastic Accessories Assortment (Black)

* UNSPSC Code: 31161816
* Thread Size: M3
* Part Number: HNLM3

https://www.amazon.com/dp/B012G6E62I

| $6 | Amazon



| Screws, Nuts

a| Screws, nuts, etc for electronics

| $4.5 | Microcenter



| Cable ties
a| Cable ties

| $5 | Homedepot



| Soldering
a| Soldering Iron Kit - Soldering Iron 60 W Adjustable Temperature, Digital Multimeter, Wire Cutter,
Stand, Soldering Iron Tip Set, Desoldering Pump, Solder Wick, Tweezers, Rosin, Wire - [110 V, US Plug]

* Heat Time: 60 seconds
* Wattage: 60
* UNSPSC Code: 41110000

https://www.amazon.com/dp/B07Q2B4ZY9

| $35 | Amazon



| Jumper Wires
a| 120pcs Breadboard Jumper Wires 10cm 15cm 20cm 30cm 40cm 50cm 100cm Optional Arduino Wire Dupont Cable Assorted
Kit Male to Female Male to Male Female to Female Multicolored Ribbon Cables

https://www.amazon.com/dp/B07GD2BWPY

| $5.80 | Amazon



| Waterproofing Spray for PCB, Conformal Coating (Optional)

a| 422B-340G Silicone Conformal Coating, Clear, 12 oz Aerosol

https://www.amazon.com/dp/B008O9YGQI

| $22.45 | Amazon



| Heat Shrink Connections (Optional, You might have enough)
a| 450pcs Heat Shrink Wire Connectors DIY Kit Heat Shrink Butt Connectors Crimping Tool Heat Shrink Tubing Heat Gun
Waterproof Marine Automotive Terminals Set

https://www.amazon.com/dp/B07W41Y7CF

| $42 | Amazon


| Heat Shrink Tubing (Optional, You might have enough)
a| Heat Shrink Tubing

| $6 | Local auto store



| Fuses
a| Fuses

6x30mm

| $6 | Local hardware store


|===


==== Boat Computer Enclosure

===== Enclosure Parts



[cols="5,12,3,4", options="header"]
|===



|Item
|Description
|Cost
|Source



| Case
a| Brand: SZOMK,  Model: AK-D-09, IP54 protection, plastic box for PCB design instrument. Black.
Dimensions exterior: W 230mm, D 210mm, H 86mm

* Brand (from inside markings): BAHAR
* Model: BDH 20014-A2

https://a.aliexpress.com/_svVwOa

| 2 * $19.80, Delivery: $7 | AliExpress



| Plastic sheets

a|ABS Black Plastic Sheets Size 12" x 12", 0.118"-1/8" thick, 2-Pack, 1 Side Textured, Black

https://www.amazon.com/dp/B0007WTF02

| $10 | Amazon


| 12v to 5v step-down converter

a|TOBSUN EA50-5V DC 12V 24V to DC 5V 10A 50W Converter Regulator 5V 50W Power Supply Step Down Module Transformer

* Over-voltage, over-current, over-temperature, short-circuit auto protection
* Input voltage: 12/24V, Output: 5V/10A

https://www.amazon.com/dp/B01M03288J

| $9.60 | Amazon



|===


For those who like 3D printing and designing your own enclosures there is a nice
project with https://www.openscad.org/[OpenScad] on ThingsVerse. See:

https://www.thingiverse.com/thing:1264391  and

https://www.thingiverse.com/thing:1355018

It's called 'The Ultimate Box Maker'.


===== Front Panel

.Front Panel Diagram
image::front-panel.svg[alt="Front Panel Diagram"]

{zwsp} +

[cols="5,12,3,4", options="header"]
|===



|Item
|Description
|Cost
|Source


| 2-Wire DC connectors SAE (Red, **Black**) Pack of 2

a| DIY 1 to 2 SAE Power Extension Cable Adapter Connector 2 Pin Quick Connect
Disconnect Plug SAE Power Extension Cable 18AWG 300mm (Pack of 2)

https://a.aliexpress.com/_seDmsO

| $10 | AliExpress



| 2-Wire DC connector (Red, **White**)

a| SAE Connector DC Power Cable, 16 AWG Quick Disconnect (Pack of 2)

NOTE: Used with 5v to distinguish from red/black for 12v

https://a.aliexpress.com/_sKPLty

| $2 | AliExpress



| USB 2.0 / HDMI

a| USB 2.0 HDMI Mount Cable – USB Extension Flush, Dash, Panel Mount Boat Cable (3.3FT/1m)

https://www.amazon.com/dp/B076DFRPLZ

| $10 | Amazon



| USB 3.0 / AUX

a| USB 3.0 & Flush Mount Cable + USB3.0 AUX Extension Dash Panel Waterproof Mount Cable
for Boat, Car and Motorcycle - 3ft

https://www.amazon.com/dp/B072KGMJ5N

| $10 | Amazon



| Panel, etc

a| 5 Gang 3 Pin Rocker Switch Panel Waterproof On-Off Toggle Switches with Pre-wired for
Car Vehicle Trailer Truck SUV Marine Boat RV Ship

https://www.amazon.com/dp/B07Z1Q8Y3G

NOTE: Used for panel parts: Switches, 12v DC Wires

| $12 | Amazon



| Voltmeter
a| DC 12V-24V Digital Panel Voltmeter Voltage Meter Tester Led Display For Car Auto
Motorcycle Boat ATV Truck Refit Accessories

https://a.aliexpress.com/_rw5xSI

| $4 | AliExpress


| Current (Ampere meter) and Voltmeter (2-pack)
a| Digital Ammeter Voltmeter DC 100V 10A 50A 100A Amp Meter Volt panel Voltage Current Meter Tester Gauge Dual LED Auto Car
https://a.aliexpress.com/_sr9X34

| $6 | AliExpress


| Light Pipes (long)
a| Fiber optic light pipes with lenses for panel mount for transfer of inside LED indicators light
to the front panel

* SMFLP12.0 492-1291-ND LIGHT PIPE CLEAR FLEXIBLE 12" (5 pack)

* Brand: Bivar Inc

* 4mm Board/Panel Mount

https://www.digikey.com/product-detail/en/bivar-inc/SMFLP12.0/492-1291-ND/2407239

| $15, Delivery: $7 | DigiKey


| Light Pipes (short)
a| Fiber optic light pipes with lenses for panel mount for transfer of inside LED indicators light
to the front panel

* Digi-Key Part Number 	492-1293-ND (LIGHT PIPE CLEAR FLEXIBLE 6", SMFLP6.0)

* Light Pipe Single Clear Flexible 6" (152.4mm) Round with Flat Top, 4mm Board/Panel Mount, Press Fit (5 pack)

* Brand: Bivar Inc

* 4mm Board/Panel Mount

https://www.digikey.com/product-detail/en/bivar-inc/SMFLP6.0/492-1293-ND/2407240

| $9 | DigiKey





| Fuse Box for Panel Mount

a| Pack of 10 AC 15A 125V Black Electrical Panel Mounted Screw Cap Fuse Holder

* Fit for: 6 x 30mm fuses
* Rated: AC 125V 15A

https://www.amazon.com/dp/B012CTCWES

| $6 | Amazon



|===

===== Back Panel

[cols="5,12,3,4", options="header"]
|===



|Item
|Description
|Cost
|Source



| SAE DC 2-pin connector

a| 14AWG 100CM SAE TO SAE Quick Disconnect Extension Cable Sae Power Connector Heavy Duty With Dust Cap

https://a.aliexpress.com/_rQdwfe

| $5 | AliExpress



| RF connector for RTL-SDR to panel

a| SMA Male to UHF PL-259 Male RG316 RF Coax Cable 1 ft

* Impedance: 50 ohm; Length: 1 ft
* Ultra Low-loss Double Shielded RG316 Coaxial Cable

https://www.amazon.com/dp/B07TF6LZC7

| $11.30 | Amazon



| RF Connector to panel for GPS antenna

a| SMA Socket Connector Panel Chassis Mount SMA Female to Female Bulkhead Extendable Antenna Jack Adapter
for Antennas Wireless LAN Devices Coaxial Cable, Pack of 2

* Antenna cable connector SMA female to female bulkhead jack adapter
* Surface treatment: Gold-plated, Impedance: 50ohm, Low-loss

https://www.amazon.com/dp/B07FKPJ4QQ

| $6 | Amazon



| AIS and RTL-SDR Antenna panel connectors

a| 2pcs SO239 Adapter UHF Female to Female Jack Bulkhead RF Connector, Impedance:50 Ohm

https://www.amazon.com/dp/B01MR16V5X

| $9.60 | Amazon



| RF chord for dAISy AIS

a| BNC Male to PL259 RG58 Cable (8 Inches); UHF PL259 Jack to BNC Male Plug Adapter Jumper Pigtail Cable RG58

* Connector: BNC Male to PL259
* Impedance: 50 Ohm
* Cable Type: RG58

https://www.amazon.com/dp/B07MK8FM94

| $5.60 | Amazon



| RJ45

a| CAT6 RJ45 Shielded Industrial Panel Mount Bulkhead Female/Female Feed Thru Coupler -
Network Connectors - IP67 Waterproof/Dust Cap (Single Pack, Black)

https://www.amazon.com/dp/B01D0N7AI8

| $11.50 | Amazon



| Terminal Block for NMEA 0183

a| Brand Name: QSU

Screw Terminal Block Kit **Long** Pins 5 mm Pitch 2, 3, 4 Pole (40 pcs)

https://www.amazon.com/dp/B07RTHD45H

| $9.50 | Amazon



| USB 2.0 Panel Mount

a| USB2.0 IP67 Waterproof Connector Industrial Standard Double Head Coupler Adapter Female to Female Socket
Plug Panel Mount with Waterproof/Dust Cap, 2pcs

https://www.amazon.com/dp/B07RPW5XGB

| $13 for 2 | Amazon



| Waterproof Cable Glands

a| 35pcs Cable Gland Waterproof Cable Fixing Head Suitable for 3mm-14mm M12 M16 M18 M20 M22
Cable Gland Joints Assortment Set (M-Black)

https://www.amazon.com/dp/B07TSC34D5

| $11 | Amazon



| HDMI and USB 3.0 Panel Mount cord
a| USB 3.0 & HDMI to HDMI + USB3.0 AUX Extension Dash Panel Waterproof Car Flush Mount Cable For Car
Boat and Motorcycle - 3ft

https://a.aliexpress.com/_sGY9fK

| $8.50 | AliExpress



| GPS G-mouse (Optional)
a| GlobalSat BU-353-S4 USB GPS Receiver (Black)

* 48-Channel All-In-View Tracking
* SiRF Star IV GPS Chipset
* WAAS/ EGNOS Support

https://www.amazon.com/dp/B008200LHW

| $26.10 | Amazon



| GPS Antenna (Optional)

a| Waterproof Active GPS Antenna with Magnetic Base - 28dB - 3-5V - SMA Connector and Adapter Included

* compatible with BerryGPS-IMU
* Magnetic base for easy placement
* Cable length is 3 meters[9.8 Feet]
* Includes SMA to uFL connector
* Active 28dB

https://www.amazon.com/dp/B0769FRT6X

| $11.50 | Amazon



| GPS Antenna

a| GPS Boat Antenna Compatible with Beidou 30dB SMA Male External Navigation Receiver 0.2 Meter Wire

* Connector: SMA Male
* Voltage: 3-5 Volt
* LNA Gain (Without Cable): 30dB
* Operating Temperature (Deg.C): -45~+85
* Center Frequency: 1575.42 MHz(GPS); 1561 MHz(BD)

https://www.amazon.com/dp/B07ZBVG1PK

| $16.25 | Amazon


| GPS Antenna Cable

a| SMA Male to SMA Female Wifi Antenna Connector Extension RG174 Cable

* 8 meter

https://a.aliexpress.com/_subQWM

| $8.40 | AliExpress


| AIS Antenna
a| Tram VHF Marine Antenna

https://www.amazon.com/dp/B01DUSBJ94

| $24.15 | Amazon



| AIS Antenna Cable

a| RG-58A/U Coaxial Cable w/Molded PL-259 Connectors (18 feet)

https://www.amazon.com/dp/B001JT1IWU

| $9 | Amazon

|===

===== NMEA Pinout and Color Coding

.NMEA Wiring Colors
image::nmea-wiring-colors.jpg[alt="NMEA Wiring Colors", width="50%", pdfwidth="50vw", align="center"]

{zwsp} +

NMEA Pins:

[cols="1,4,2", width="30%"]
|===
|1|White |Tx+
|2|Brown |Tx-
|3|Yellow|Rx+
|4|Green |Rx-
|5|Black |Gnd
|===

{zwsp} +

.NMEA Pins 1-2-3-4-5. 1 is left, 5 is right
image::nmea-pins.jpg[alt="NMEA Pins 1-2-3-4-5. 1 is left, 5 is right", width="50%", pdfwidth="50vw", align="center"]

{zwsp} +


===== Assembly Activities

Make sure you use correct tools for:

* Measuring
* Cutting
* Clamping
* Drilling
* Heat Shrinking
* Tying
* Crimping
* Screwing

===== Tools

 Drill, Screwdriver, Drill bits, Large hole drill bit, Cutting knife, Caliper,
 Soldering Kit, Rotary Tool (Like Dremel), Heat Gun, Crimper Tool



==== Computer and Sensors

===== Raspberry Pi 4

.Raspberry Pi 4 Diagram
image::RaspberryPi_4_Model_B.svg[alt="Raspberry Pi 4 Diagram"]

{zwsp} +

This file is licensed under the Creative Commons Attribution-Share Alike 4.0 International license

https://creativecommons.org/licenses/by-sa/4.0/deed.en

====== Sensors and Parts

[cols="5,12,3,4", options="header"]
|===



|Item
|Description
|Cost
|Source



| Pi 4
a| Raspberry Pi 4, 4Gb + Power Supply

| $65 | Amazon



| Heat sinks and Cooling fan, Case

a| Acrylic Case for Raspberry Pi 4 Model B & Raspberry Pi 3 Model B+, Raspberry Pi Case with Cooling Fan and
7PCS Heatsinks for Raspberry Pi 3/2 Model B/B+ (Brown)

https://www.amazon.com/dp/B07T3DRB1C

| $9 | Amazon




| USB Hub

a| USBGear 7-Port USB 3.0 Charging and SuperSpeed Mountable Data Hub

https://www.amazon.com/dp/B012DZ4RJY

| $35 | Amazon



| FTDI Serial to USB (2pcs)

a| DSD TECH SH-U11 USB to RS485 RS422 Converter with FTDI FT232 Chip Compatible with Windows 10, 8, 7, XP and Mac OS X

https://www.amazon.com/dp/B07B416CPK

| $34 (for 2) | Amazon



| USB Isolator (Optional)

a| USB To USB Isolator Industrial Grade Digital Isolators With Shell 12Mbps Speed ADUM4160/ADUM316 USB Isolator Drop Ship

https://a.aliexpress.com/_sobQw2

| 11.20 | AliExpress



| USB Type-B short cable

a| USB 3.0 A Male AM to USB 3.0 B Type Male BM USB3.0 Cable 0.6m

https://a.aliexpress.com/_rv8IcU

| $6 | AliExpress



| SSD Flash Drive
a| Samsung Fit Plus USB 3.1 Flash Drive 128GB

https://www.amazon.com/dp/B07D7PDLXC

| $30 | Amazon



| SD Card
a| SanDisk Extreme Plus 32GB, 90MB/s
| $16 | Office Depot



| HDMI adapters
a| Cable Matters 2-Pack Micro HDMI to HDMI Adapter (HDMI to Micro HDMI Adapter) 6 Inches with 4K and HDR Support

https://www.amazon.com/dp/B00JDRHQ58

| $9 | Amazon



| dAISy AIS + BNC Adapter
a|
https://shop.wegmatt.com/products/daisy-ais-receiver?variant=7104299008036

| $67.70 | wegmatt.com



| RTL-SDR

a| RTL-SDR Blog V3 R820T2 RTL2832U 1PPM TCXO HF Bias Tee SMA Software Defined Radio with Dipole Antenna Kit

https://www.amazon.com/dp/B011HVUEME

| $30 | Amazon




| IMU + environmental sensors

a| BerryGPS-IMUv3 - GPS and 10DOF for The Raspberry Pi - Accelerometer, Gyroscope, Magnetometer and Barometric/Altitude Sensor

NOTE: You can ask to pre-solder a header

https://www.amazon.com/dp/B072MNBC9M

| $53.50 | Amazon





| RTC Clock (Optional)
a| 2pcs DS3231 AT24C32 IIC RTC Clock Module Real Time Clock Module for Arduino Raspberry Pi

https://www.amazon.com/dp/B082G6MXVR

| $7 | Amazon

|===

===== Other Things to Consider (Add-ons)

NOTE: What could I have done better? I think I could use one of the power boards
like 'DockerPi power board' with momentary switch for safe shutdown. Or even
couple Geekworm X828 SATA board (made by SupTronics Technologies) with their
X710 power board. With those I wouldn't need internal USB hub and 12vDC to 5vDC
internal step down converter.

See:

https://geekworm.com/collections/raspberry-pi-4/products/raspberry-pi-x710-power-management-with-wide-voltage-input-6v-to-36v-safe-shutdown-expansion-board

https://geekworm.com/collections/raspberry-pi-4/products/raspberry-pi-x828-stackable-2-5-sata-hdd-ssd-shield


NOTE: (Update: Jan 2020) There is even better board came out. SupTronics X180. 7-Port USB 3.0 self powered hub shield
for raspberry pi 4. So I'd use x710 and x180 combo.

http://www.suptronics.com/miniPCkits/x180.html


NOTE: Another couple of interesting boards are discussed here http://forum.openmarine.net/showthread.php?tid=1666&page=3
NMEA multiplexer, current, voltage and RPM sensors for engine/battery monitoring and fridge and thermostat control board.

* RTC Clock
* Opto couplers for NMEA interfaces
* Safe power down method
* Boot from USB SATA SSD
* Coaxial Lightning Arresters for RF cables
* Mount SD card reader to front panel to swap easier

.Amp Meter Wiring Diagram
image::amp-meter-wiring.jpg[alt="Amp Meter Wiring Diagram"]

====== Real blue water (off-shore) boat features (just brain storming)

* GPS and chartplotter
* AutoPilot (PyPilot)
* AIS
* True Radar
* Automated WeatherFax via RTL-SDR, Satellite Weather, GRIBs via https://sailmail.com/
* Integration with Satellite Modems as Iridium
* Low power usage
* Weather Routing
* Better Integration with SSB radio via SDR stick, Morse decoding/encoding (?)
* Better Celestial Navigation
* Bilge Alarm, Better Alarms Overall (Deadman, Anchor Watch, Collision Avoidance, Jibe Warning, Landfall)
* Better monitoring of power usage of the boat
* Integration with Solar/Wind power generators
* Lightning strike front detection
* Wind/Speed/Drift (There are through hull transducers already which measure drift) NMEA sensors with True Wind calculation
* Comfort features: E-mail, Instagram, Spotify, Log Book, Blog Keeping better integration
* Integration with windlass and bow thrusters
* Active Captain, Squidd.io type of services integrated
* Security features, VPN, AdBlocking, Fire Alarms, Motion Sensors
* Better integration with engine sensors (temp, power, oil pressure, RPM, fuel usage, etc)
* FishFinder integration
* NightVision
* Sail Trim sensors and integration with powered winches
* More Maps and Charts
* Search and Rescue Patterns
* M5Stack deserves more attention


==== Testing Boat Computer and Cockpit Display

===== OpenCPN 5.0.522

.OpenCPN MBTiles
image::opencpn-1.png[alt="OpenCPN MBTiles"]

{zwsp} +

.OpenCPN Vector
image::opencpn-2.png[alt="OpenCPN Vector"]

{zwsp} +

.OpenCPN Dashboard
image::opencpn-3.png[alt="OpenCPN Dashboard"]

Saving it as a template in OPenCPN was a bit tricky on 7" screen as OpenCPN window is too big to see 'OK' button.
I had to press Ctrl-Tab twice followed by Enter, doing it basically blindly.

{zwsp} +

===== Power Usage

* Preliminary tests show that combined power consumption of Raspberry Pi 4 based boat computer and
Argonaut M7 gen2 7-inch touch display stays under 10 watts.
If I turn off the display then wattage drops to 4-4.5 watts. If I reduce the brightness on the display backlight
it drops dramatically as well. So both display and Pi contribute about the same share in power consumption.
On average I see their combined draw of 0.75 amps at 12v (about 9 watts). This is with 2 chained USB hubs
and long wires (HDMI/USB/power) between a computer and cockpit display and hub, AIS (dAISy), RTL-SDR (plugged in but
idling), Flashdrive SSD, FTDI (connected only into USB).
* 10 watts on 80 amp-hours 12v battery (in my understanding they are rated for that before drop below 10v,
so it is all usable amps) will give you approximately 80*12/10=96 hours of chartplotting at max brightness. C'est la vie.
That's why you need solar panels on your sailboat.
* While experimenting with power usage and connecting/disconnecting various USB devices and
Argonaut M7 to different USB ports and hubs (USB2, USB3) Argonaut M7 became unresponsive.
Even its own power on/off button didn't work. I had to perform a factory reset of it.
* The reset procedure as per manufacturer requires to hold power button on Argonaut M7 display immediately after
full power off/on cycle. On my boat it's really a two-man job then. There is no power switch in cockpit because
the M7 display has its own and the other switch to power it on is below deck. It seems they didn't think about
single handed sailors when they came up with this reset procedure design.
* Turns out if I turn off 12v supply into cockpit it does turn-off the display but it's LED status light still stays on.
So it still gets some power via USB (not much per amp meter). Apparently this is the default behavior of most self powered
USB hubs to draw from the host when they lose own power supply. There are some hubs which have this behavior configured
by a jumper on their PCB, but the default is to power itself from the host.
* I did test fiber-optic USB data cable leading to the cockpit as well. It does have regular wires for power as well, so
it behaves exactly the same. The cable is much thinner so you can have a smaller hole is your boat in a cockpit deck.
* Reboot doesn't work. It just shuts down Pi. There are many reports that pi4 doesn't reboot with USB self powered hubs
if they are not powered off before the reboot and backfeed power into Pi.
So currently the reboot procedures are shutdown and then power cycle the boat computer.
* I've tried installing rpi-backlight but it seems Argonaut M7 monitor doesn't support software backlight control
(at least it doesn't work under Linux) So the only way to control backlight is via Argonaut's own control on
the side of the monitor.


NOTE: After long testing and research I've found a solution for UBS hub power issues. There are two. The first one
is that the hub in cockpit powers the cockpit via USB hub even if I turn the cockpit 12v switch off. The second one is
that Pi doesn't reboot as it stays powered from the hubs. The simplest way to solve it was to tape
USB +5v pin inside female part of USB type A plugs with the electrical tape (see pic). There are two places because
there are 2 self powered hubs need to be isolated. The procedure is actually makes the whole set up even safer.
You do not want extra circuits running from below deck into the cockpit when cockpit
switch is 'off'. Power savings when you turn cockpit off are impressive. Pi takes less than 0.2 amps @ 12v with no HDMI
video connected (only USB connected sensors and flash drive stick). For the cockpit USB 3.0 hub I got
the shortest USB 3.0 type A male to female cable and put tape in it. And for the computer's hub I've just taped
it inside USB 3.0 type-A male part connecting the hub. This is how it was done:

.USB 3.0 self-powered hub backfeed and forward-feed power isolation male
image::boat-computer/usb-hub-isolation-male.jpg[alt="USB 3.0 self-powered hub backfeed and forward-feed power isolation male", width="40%",  pdfwidth="40vw", align="center"]

{zwsp} +

.USB 3.0 self-powered hub backfeed and forward-feed power isolation female
image::boat-computer/usb-hub-isolation-female.jpg[alt="USB 3.0 self-powered hub backfeed and forward-feed power isolation female", width="40%",  pdfwidth="40vw", align="center"]

{zwsp} +


Temperature readings stay under 56 C.

[source, shell]
-----
pi@raspberrypi:~ $ vcgencmd measure_temp
temp=48.0'C
-----

Check your USB set up
[source, shell]
-----
pi@openplotter:~ $ sudo apt install uhubctl
pi@openplotter:~ $ sudo uhubctl
Current status for hub 2-1.4 [05e3:0612 GenesysLogic USB3.0 Hub, USB 3.00, 4 ports]
  Port 1: 02a0 power 5gbps Rx.Detect
  Port 2: 02a0 power 5gbps Rx.Detect
  Port 3: 02f0 power 5gbps Polling reset
  Port 4: 02a0 power 5gbps Rx.Detect
Current status for hub 2-1 [05e3:0612 GenesysLogic USB3.0 Hub, USB 3.00, 4 ports]
  Port 1: 0203 power 5gbps U0 enable connect [090c:1000 Samsung Flash Drive FIT 0353019060002728]
  Port 2: 02a0 power 5gbps Rx.Detect
  Port 3: 02a0 power 5gbps Rx.Detect
  Port 4: 0263 power 5gbps U3 enable connect [05e3:0612 GenesysLogic USB3.0 Hub, USB 3.00, 4 ports]
Current status for hub 2 [1d6b:0003 Linux 4.19.97-v8+ xhci-hcd xHCI Host Controller 0000:01:00.0, USB 3.00, 4 ports]
  Port 1: 0203 power 5gbps U0 enable connect [05e3:0612 GenesysLogic USB3.0 Hub, USB 3.00, 4 ports]
  Port 2: 02a0 power 5gbps Rx.Detect
  Port 3: 02a0 power 5gbps Rx.Detect
  Port 4: 02a0 power 5gbps Rx.Detect
Current status for hub 1-1.1.4 [05e3:0610 GenesysLogic USB2.0 Hub, USB 2.10, 4 ports]
  Port 1: 0103 power enable connect [0403:6001 FTDI FT232R USB UART AK08UZHY]
  Port 2: 0100 power
  Port 3: 0503 power highspeed enable connect [05e3:0610 GenesysLogic USB2.0 Hub, USB 2.10, 4 ports]
  Port 4: 0103 power enable connect [067b:2303 Prolific Technology Inc. USB-Serial Controller D]
Current status for hub 1-1.1 [05e3:0610 GenesysLogic USB2.0 Hub, USB 2.10, 4 ports]
  Port 1: 0100 power
  Port 2: 0503 power highspeed enable connect [0bda:2838 Realtek RTL2838UHIDIR 00000001]
  Port 3: 0103 power enable connect [16d0:0b03 Adrian Studer dAISy AIS Receiver 76443A5131002900]
  Port 4: 0503 power highspeed enable connect [05e3:0610 GenesysLogic USB2.0 Hub, USB 2.10, 4 ports]
Current status for hub 1 [1d6b:0002 Linux 4.19.97-v8+ xhci-hcd xHCI Host Controller 0000:01:00.0, USB 2.00, 1 ports]
  Port 1: 0503 power highspeed enable connect [2109:3431 USB2.0 Hub, USB 2.10, 4 ports]
-----

Check SSD Drive transfer speed
[source, shell]
-----
pi@openplotter:~ $ sudo apt install hdparm
pi@openplotter:~ $ sudo hdparm -Tt /dev/sda

/dev/sda:
 Timing cached reads:   1948 MB in  2.00 seconds = 974.71 MB/sec
 Timing buffered disk reads: 628 MB in  3.00 seconds = 209.28 MB/sec
-----

===== Assembly Activities

Make sure you use correct tools for:

* Soldering
* Screwing

=== Cockpit Display and Chartplotter

.Cockpit Display Diagram
image::cockpit-display.svg[alt="Cockpit Display Diagram"]

{zwsp} +


[cols="5,12,3,4", options="header"]
|===



|Item
|Description
|Cost
|Source



| NavPod
a| NavPod GP2300

| $225, Shipping: $9 | anchorexpress.com



| 5V/6V 3A Switch-mode UBEC, Max 5A Lowest RF
a|
https://www.amazon.com/dp/B008ZNWOYY

| $3 | Amazon



| Waterproof touch screen
a| Argonaut M7-gen2 + Water Sealed back

https://www.argonautcomputer.com/products/m7-smart-touch-monitor

| $518 | argonautcomputer.com



| DC Wire to cockpit
a| Marine Wire

https://www.amazon.com/dp/B01FRK09OY

| $25.50 | Amazon



| Female to Female HDMI adapter
a|
* Compatible with HDMI standard (4K video at 60 Hz, 2160p, 48-bit/px color depth)
* Supports bandwidth up to 18Gbps
* backwards compatible with earlier versions

https://www.amazon.com/dp/B07K6HKD8S

| $4.75 | Amazon



| Standard Horizon MMB-97 Flush Mount Kit for Explorer GX1600/GX1700

a|
https://www.amazon.com/dp/B004NZOV8A

| $16.50 | Amazon



| USBGear 4-Port USB 3.0 Mountable Charging and 5Gbps Data Hub

a|
* Supports Super-Speed USB 3.0 over each port with transfer rates up to 5Gbps.
* Power Adapter: 5V 2A output, 100-240V, 50/60Hz 0.40A

https://www.amazon.com/dp/B012DZ4NJ8

| $29 | Amazon



| USB 3.0 Extension Cable 20ft, Hftywy USB Type A Male to Female Extension Cord 5Gbps Data Transfer, Red

a|
https://www.amazon.com/dp/B07XF3GM1W

NOTE: Consider also fiber optic USB 3.0 active extension cables

| $13 | Amazon


| Long HDMI Cable
a| Postta HDMI Cable(25 Feet) Ultra HDMI 2.0V Cable with 2 Piece Cable Ties+2 Piece HDMI Adapters
Support 4K 2160P,1080P,3D,Audio Return and Ethernet, Blue

https://www.amazon.com/dp/B075YPT2F1

NOTE: Consider also fiber optic HDMI cables

| $14 | Amazon



| Air Mouse and wireless keyboard and touchpad
a|
H18+ 2.4Ghz Mini Wireless Keyboard Touchpad Combo with 3 Level Backlit Rechargeable Full Screen Mouse Remote Control
for Android TV Box, Projector, IPTV, HTPC, PC, Laptop

https://www.amazon.com/dp/B0776T8QDC

| $20 | Amazon





| AcuRite 02020 Portable Lightning Detector (Optional)
a|
* Detects lightning bolts and storms within 25 miles
* Warning light, audible alarm and text alerts

https://www.amazon.com/dp/B00EO1H3X8

| $30 | Amazon



| 12v to 1.5v DC Converter (Optional - For AcuRite Lightning Detector)
a| AMS1117 1.5V (4.75-12V) output 1.5V Step Down Power Supply Module AMS1117-1.5V

https://a.aliexpress.com/_sXL1Bu

| $1 | AliExpress



| In-Line Marine Fuse Holder
a| In-Line Marine Fuse Holder 6x30 mm

| $7 | Amazon



| Wireless Phone Charger and Holder (Optional: I think I can DIY much cheaper)
a| ScanStrut ROKK Wireless - Active (SC-CW-04E) 12v / 24v Waterproof Wireless Phone Charging Mount

https://scanstrut.com/products/waterproof-wireless-charge/rokk-sc-wc-04-detail

| $97.60 | hodgesmarine.com


|===

{zwsp} +

=== Boat Gateway Box

The second box is a boat LTE/WiFi/IoT gateway device and it is an extension to the boat computer.
In case if you do not need HDMI display you might need only the boat gateway because the boat gateway runs its own KPlex
server under OpenWrt Linux. The boat gateway has M5Stack ESP32 micro-controller and is capable to connect to NMEA
(if you customize if a bit further). The boat gateway is connected to the boat computer via Ethernet.
The boat gateway uses the same type of an enclosure as the boat computer.

Features of the boat gateway box:

* WiFi Gateway (connecting to marina's WiFi and on-shore WiFi hot-spots via a long range WiFi antenna)

* LTE / 4G Gateway (providing a boat with Internet and voice access within the zone of reception
of a cellular network)

* VPN gateway

* Ethernet Hub

* Network Access Storage, Network back-up

* M5Stack ESP32 Controller and 3-Buttons LCD display (panel mounted, numerous optional M2Stack add-ons)

* KPlex server running on router's OpenWrt Linux

* GPS NMEA 0183 talker via KPlex

* IoT gateway with MQTT

* Voltage and Amperage Display to monitor power consumption

* Any other additional sensors and devices can be added via M5Stack. M5Stack is programmable micro-controller without
an operating system but very capable of running complex programs

==== Boat Gateway Front Panel

* Power On/Off Switch

* Router Power On/Off Switch

* Panel Mounted Fuse Box

* Panel Mounted M5Stack LCD Display with 3 Buttons

* USB 2.0 Port connected to M5Stack

* Amp and Volt Meter


.Boat Router Front Panel View
image::boat-router/router-front-panel-1.jpg[alt="Boat Router Front Panel View", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

.Boat Router Front Panel Wiring
image::boat-router/router-front-panel-2.jpg[alt="Boat Router Front Panel Wiring", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +


==== Boat Gateway Back Panel

* SAE power (red/black, red male) 12V connector with waterproof gland to boat 12v

* Two SMA coax connectors to external cellular LTE antennas

* SMA RP coax connector for external long range WiFi antenna

* SMA coax connector to external active GPS antenna

* Three Ethernet Ports with water tight caps for LAN

* Ethernet port with water tight cap for WAN


.Boat Router Back Panel View
image::boat-router/router-back-panel-1.jpg[alt="Boat Router Back Panel View", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

.Boat Router Back Panel Wiring
image::boat-router/router-back-panel-2.jpg[alt="Boat Router Back Panel Wiring", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +


==== Inside Boat Gateway

{zwsp} +

.Boat Router Inside
image::boat-router/router-inside.jpg[alt="Boat Router Inside", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

.Boat Router Inside Top
image::boat-router/router-inside-1.jpg[alt="Boat Router Inside Top", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

.Boat Router Inside Bottom
image::boat-router/router-inside-2.jpg[alt="Boat Router Inside Bottom", width="75%",  pdfwidth="75vw", align="center"]

I've made an opening for easier access to SIM card and SD card slots. A better idea probably would be
to have SD and SIM card extension cords and panel mounted slots.

{zwsp} +

[cols="5,12,3,4", options="header"]
|===



|Item
|Description
|Cost
|Source




| GL-X750 LTE 4G/3G and Wifi Router (It's the best choice, GL-AR750 is not needed if you pick this)
a| GL.iNet Spitz (GL-X750) 4G Router & 4G Modem (with Sim card slot) for your area and cellular provider

* Transfer 4G LTE signal to Wi-Fi, 5G (433Mbps), 2.4G(300Mbps) Wi-Fi, 4G (EC25, EP06) PCIe modules
* Powered by Atheros AR9531, @650Mhz
* 2 x 4G LTE external antennas, 2dBi 5G & 2.4G internal antennas
* Interface: 1WAN, 1LAN, 1USB2.0, 1 MicroSIM slot, 1 MicroSD slot
* OPEN SOURCE & PROGRAMMABLE: OpenWrt/LEDE, OpenVPN pre-installed
* 12v input power

https://www.gl-inet.com/products/gl-x750/

| $119 + Modem: $20 + (Optional not really needed
bluetooth module and wall mount: $16) | gl-inet.com



| WiFi Router (not needed if you go with GL-X750 option)
a|
GL.iNet GL-AR750 Travel AC Router, 300Mbps(2.4G)+433Mbps(5G) Wi-Fi, 128MB RAM, MicroSD Storage Support, OpenWrt/LEDE

* OpenWrt/LEDE (open source)
* OpenVPN client pre-installed
* 128MB RAM, up to 128GB MicroSD slot, USB 2.0 port, three Ethernet ports, and optional PoE module

https://www.amazon.com/dp/B07712LKJM

| $45 | Amazon



| WiFi RF Connector Cable (*RP*)
a| U.FL Mini PCI to *Reverse Polarity* SMA Pigtail Antenna WiFi Cable Pack of 2

* Reverse Polarity SMA Female ( *Pin in center* ) to IPX ufl Female Coaxial Connector

https://www.amazon.com/dp/B005UWD0EG

| $5.30 | Amazon


| GPS RF Connectors
a| Pack of 4 RF U.FL(IPEX/IPX) Mini PCI to SMA Female Pigtail Antenna
Wi-Fi Coaxial RG-178 Low Loss Cable (7 inches (17.8 cm))

https://www.amazon.com/dp/B06Y6CB2SX

| $14.30 | Amazon



| LTE RF Connectors
a| SMA Extension Cable Pigtail Male to Female WiFi Antenna Cable RF RG316 Coaxial
Coax Jumper FPV SMA Antenna Wire (4 inch (4 Pcs))

https://www.amazon.com/dp/B0813RPPTX

| $12 | Amazon



| Ethernet Switch
a| Tenda S105 V2.0 Slim 5-Port Fast Ethernet Switch

https://www.microcenter.com/product/486440/tenda-s105-v20-slim-5-port-fast-ethernet-switch

| $9 | Microcenter


| Ethernet short patch cables 5-pack
a| Ethernet short patch cables 5-pack

QVS CAT 5e Snagless Network Cable 6 in. 5 Pack – Multi-Colored

| $12.50 | Microcenter


| 4 Panel Mount RJ45 Sockets

a| RJ45 Extension Female Cable Connector CAT5/6 Network Cable Socket Connector IP67 Waterproof

https://a.aliexpress.com/_sfaqAI

| $13.80 | AliExpress



| USB 2.0 Panel Mount

a| IP67 USB 2.0 4pin female to Female Waterproof data Connector plug socket Adapter IP 67 Water Proof Connectors

https://a.aliexpress.com/_sC6Vb8

| $9 | AliExpress


| 5V/6V 3A Switch-mode UBEC, Max 5A Lowest RF
a|
https://www.amazon.com/dp/B008ZNWOYY

| $3 | Amazon



| Micro Sim Adapter
a| Sim Card Adapter Kit Includs Nano Sim Adapter / Micro Sim Adapter / Needle / Storage Sheet( Sim Card Holder )

https://www.amazon.com/dp/B00HSOUQXM

| $4.30 | Amazon




| WiFi Antenna Cable
a| Low Loss RG58 WiFi Cable N Male to RP SMA Male Connector Hole in Center Pigtail SMA Cable 10M for
3G/4G/LTE/Ham/GPS/RF Radio to Antenna or Surge Arrester Use

* Connector Gender 	N male , RP SMA Male
* Model Number 	Lii-03695
* Cable Length 	32.8 feet

https://www.amazon.com/dp/B075MBXBY2

| $16 | Amazon


| Long Range WiFi Antenna
a|
Lysignal Outdoor Omni Directional Antenna Fiberglass 2.4GHz 8dBi N Female Connector for Cell
Phone Signal Booster, WiFi Router

* Complies with all 802.11n/b/g (2.4GHz) products
* High power, high gain outdoor wifi antenna. Extend coverage of a wireless network in all directions
* Waterproof, striking resistant, anti-corrosion
* RP (reverse polarity) SMA connector

https://www.amazon.com/dp/B07PG8RPSL

NOTE: This has RP SMA connector, so corresponding panel mount part will need to be RP SMA.

| $36 | Amazon


| IPEX U.FL Solder Sockets
a|
10pcs IPEX U.FL SMD SMT Solder for PCB Mount Socket Jack Female RF Coaxial Connector

https://www.amazon.com/dp/B07V3BV15W

| $7 | Amazon



| LTE/4G/3G Antenna
a|
700~2600mhz 88dbi 3g 4g Lte Antenna Mobile Antenna 2 * SMA Male Connectors Booster Mimo Panel Antenna, 5 Meters

* Indoor
* Wall mount

https://a.aliexpress.com/2iIG1Kc0

| $15.10 | AliExpress



| M5Stack Core
a|ESP32 Basic Core IoT Development Kit

* ESP32 micro controller
* Integrated 802.11b/g/n HT40 Wi-Fi transceiver, baseband, stack and LWIP
* Bluetooth, BLE
* 4 MByte flash + 520K RAM
* Speaker, 3 Buttons, LCD(320*240), 1 Reset
* 10x capacitive touch interface

https://m5stack.com/collections/m5-core/products/basic-core-iot-development-kit

| $28 | m5stack.com



| M5Stack LAN Module Base
a|LAN is a M5 Base that having a W5500 chip, which is a Hardwired TCP/IP embedded
Ethernet controller that provides easier Internet connection to embedded systems.
This Base is specifically
designed for industrial application scenarios, comes with couple of HT3.96 connectors

* Input Supply Voltage: 9-24V
* HT3.96 port for supporting RS485
* TTL-to-RS485 adapter board

https://m5stack.com/products/lan-module

https://m5stack.com/collections/m5-base/products/lan-module

| $14 | m5stack.com



| M5Stack Panel Mount Accessory
a|FRAME Panel Extended Install Components (2 Sets)

https://m5stack.com/collections/m5-accessory/products/frame-panel-extended-install-components

| $3.40 | m5stack.com


|===

.M5Stack ESP32 Controller Board
image::m5stack-board.jpg[alt="M5Stack Board", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

"M5Stack" stands for "Modular 5cm Stackable".

Looks like waterproof version is already in works.

See: https://twitter.com/m5stack/status/1164091308895457280?lang=en


.M5Stack LCD and Communication Module
image::m5stack-lcd.jpg[alt="M5Stack LCD", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

===== GL-AR750 Router Modifications

The AR-750 router needs to be modified to add external 2.4GHz antenna. Test U.FL connectors need to be removed
and real ones should be soldered. The existing U.FL connector is used by internal 5G band antenna.
See here:

https://www.arednmesh.org/comment/12706#comment-12706

===== GL-X750 (Spitz) Router Modifications

You get this router with the modem you selected for your region. My modem is Quectel EP06-A.
EP06-A has 3 antenna connectors. One is connected to external LTE antenna connector, another one
is Rx Diversity antenna to external connector and middle one is GPS antenna not connected. You can open up router
by unscrewing two screws under serial number sticker (it's easy to remove and put back after).
I've just put another coax cable to GPS antenna connector and cut a bit of plastic in the case just
enough to put that cable through (SMA side on outside).

.GL-X750 Antenna Mod
image::gl-x750.jpg[alt="GL-X750 Antenna Mod", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

.GL-X750 Case Mod
image::gl-x750-antenna-mod.jpg[alt="GL-X750 Screws", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

The modem is controlled via 'AT' commands.

Make sure you connect antennas first before activating SIM card in the network or you might get error like:

 SIM card not registered

APN for AT&T has to be set to "broadband".
Device: /dev/ttyUSB2
Service: LTE/UMTS/GPRS


To enable the GPS you have to use

 AT+QGPS=1

command on /dev/ttyUSB2 and then one can read the nmea sentences on /dev/ttyUSB1.
There are additional commands to configure the GNSS functions, but they’re very limited compared
to “regular GNSS chips”. The details can be found in the Quectel EP06&EG06&EM06 GNSS AT Commands Manual.
(Registration required to download)

The command to reset the modem to factory defaults is

 AT+QPRTPARA=3

The router is running linux. While setting it up you can login into it like this:

 ssh root@192.168.8.1

The password would be the one you set in web UI.

Hmm:
There is even KPlex for OpenWrt. I think this GPS can be fed into OpenPlotter from the router!

https://github.com/caesar/kplex-openwrt

And you can install KPlex on a router (precompiled) from the router itself!

{zwsp} +

.KPlex on OpenWrt Router
image::KPlex-OpenWrt-Router.png[alt="KPlex on OpenWrt Router"]

{zwsp} +

AT command for the GPS needs to be run every time on boot. This needs to be scripted.
Install the program called 'socat'. With it you can send commands to the modem from command line.

[source]
----
 echo "AT+QGPS=1" | socat - /dev/ttyUSB2,crnl
----

[source]
----
vi /etc/kpex.conf
----

Put these lines

[source]
----

[serial]
name=gps
filename=/dev/ttyUSB1
direction=in
baud=9600
strict=no

[tcp]
name=router
mode=server
port=10110
direction=out

----


Add startup script

----

cat > /etc/init.d/modem-gps-init
#!/bin/sh  /etc/rc.common

START=98

start()
{
     echo "AT+QGPS=1" | socat - /dev/ttyUSB2,crnl
}

^D

chmod 755 /etc/init.d/modem-gps-init

----

Another modification: By default in GL-X750 one Ethernet port is set up as WAN and another is LAN.
You can reassign them both as LAN. It is done in web UI of the router.
One LAN port will go to main boat computer and another lan port you can connect to M5Stack LAN base module.
Or even have a ethernet hub inside if you plan bigger boat LAN (in that case you can leave one port as WAN and
connect the router via hub).

GL-X750 aka Spitz router power supply is 12v (No need for buying step-down converter).

NOTE: If you just need chart plotter capabilities it seems you do not even need raspberry pi. You could just install
KPlex on GL-X750 router make sure the modem you picked when you buy the router has GPS. And then you use
OpenCPN installed on an android tablet connected via WiFi to KPLex. And with this you have LTE internet on your boat
and local private WiFi.

NOTE: FlashDrive Stick inserted into the router USB port is automatically shared on network via samba. You should
mount it using this command:

[source, shell]
------
sudo mount -t cifs //gl-x750/SamsungUSB /media/Share -o user=guest,vers=1.0
------

===== Local WiFi, VNC, etc

====== VNC

https://www.realvnc.com/raspberrypi/

===== WiFi Gateway

https://www.gl-inet.com/products/gl-ar750/

====== OpenVPN

https://openvpn.net/

====== OpenWrt

https://openwrt.org/

====== LongFi Helium

https://www.helium.com/

===== Boat IoT, MQTT, M5Stack

====== MQTT

http://mqtt.org/

http://mosquitto.org/

====== M5Stack ESP32

https://m5stack.com/

====== RTL 433

https://github.com/merbanan/rtl_433

===== Boat Cellular LTE Voice and Data Gateway

====== SMS

====== OpenAirInterface

https://www.openairinterface.org/

==== Testing the Boat Gateway

{zwsp} +

.Boat Router Testbed
image::boat-router/boat-router-testbed.jpg[alt="Boat Router Testbed", width="75%",  pdfwidth="75vw", align="center", rotate]

{zwsp} +

.Boat Router LTE Speed
image::boat-router/boat-router-lte-speed.jpg[alt="Boat Router LTE Speed", width="75%",  pdfwidth="75vw", align="center"]

===== Good

* LTE speed is good even with two little antennas it came with.
* Time to acquire a GPS location fix is very short with external antenna. I do not have exact time but it's under
few minutes even inside the house. Having external GPS antenna made a huge improvement.
* Power usage of the whole gateway box in well under 2 watts. 2 watts is under speed stress test with uploads over LTE.

===== Not so good

* External WiFi antenna (the one from the bill of material) did very little to improve the range. (Again I've tested
it inside the house, without placing the antenna outside). My modification of the connector inside the router and soldering
it might have been not good so you might have better results.
* Bigger LTE antenna (again from the bill of material) didn't give better signal quality (even a bit lower) than
original antennas supplied with Spritz router. (Could be different picture on other bands though). With either of
antennas LTE performed well.


==== Other Ideas

Rudder Position project

https://hackaday.io/project/168592-opencpn-chart-plotter-w-autopilot-and-waypoints

== Boat Software

=== Software Data Flow

.Software Architecture
ifdef::env-github[image::software-arch.svg[Software Architecture]]
ifndef::env-github[]

[plantuml,software-arch,svg]
....
!include plantuml/software-arch.puml
....

endif::[]

{zwsp} +

{zwsp} +

=== Network Diagram

.Network Diagram
ifdef::env-github[image::network-arch.svg[Network]]
ifndef::env-github[]

[plantuml,network-arch,svg]
....
!include plantuml/network-arch.puml
....

endif::[]

Issuing this command:

[source, shell]
-----
ifconfig -a
-----

On a router and on the boat computer will give good idea of the current configuration and status of local
network (TCP/IP) interfaces.

On your boat computer install nmap

[source, shell]
-----
sudo apt install nmap
-----

and use

[source, shell]
-----
nmap -sP 192.168.8.0/24
-----

To discover all network devices on your boat local network. After you done with all the set up there would be
Pi, router, m5stack.

=== Important local URLs on your boat


* Router admin UI http://192.168.8.1 or http://gl-x750

* SignalK web UI  http://localhost:3000

* Connects to KPlex running on the router
+
[source, shell]
------
telnet gl-x750 10110
------

* Connects to SignalK running on the boat computer (Should be configured to output NMEA data, with a SignalK
NMEA translation plugin)
+
[source, shell]
------
telnet localhost 10110
------

* Connects to SignalK running on the boat computer (SignalK protocol)
+
[source, shell]
------
telnet localhost 8375
------

* Chronograf http://localhost:8888

* Grafana http://localhost:3001



=== Openplotter

==== Basic Installation Steps

.Basic Installation Steps
ifdef::env-github[image::basic-install-steps.svg[Basic Installation Steps, width="75%", height="75%"]]
ifndef::env-github[]

[plantuml,basic-install-steps,svg]
....
!include plantuml/basic-install-steps.puml
....

endif::[]

{zwsp} +

==== Installation

After completing installation you can see which packages got installed.

[source,shell]
----
sudo apt list --installed | grep opencpn
sudo apt list --installed | grep openplotter
----

To see which available OpenCPN packages are there:

[source,shell]
----
apt-cache search opencpn
----


==== Initial Settings

[.text-center]

You would need to enable SPI, I2C, Serial Port, 1-Wire and Remote GPIO and
disable Serial Console in Raspberry Pi Configuration utility. See:

.Raspbian Interfaces Settings
image::config/raspbian-settings.png[Raspbian Interfaces Settings, width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

Reboot after changing settings in Raspberry Pi Configuration screen.

In Openplotter Serial you need to enable UART. This will disable Bluetooth. Reboot after it.

Your /boot/config.txt should look like this (I've stripped the commented lines):

[source]
-----
arm_64bit=1

disable_overscan=1

dtparam=i2c_arm=on
dtparam=spi=on
dtparam=audio=on

[pi4]
dtoverlay=vc4-fkms-v3d
max_framebuffers=2

[all]
gpu_mem=512
enable_uart=1
dtoverlay=w1-gpio
dtoverlay=pi3-disable-bt
-----

* arm_64bit=1 is for enabling 64-bit linux kernel.
* gpu_mem=512 reserves 512Mb of memory to the graphic video card.

==== Setting Serial Devices

[source, shell]
------
pi@raspberrypi:~ $ lsusb
Bus 002 Device 004: ID 05e3:0612 Genesys Logic, Inc. Hub
Bus 002 Device 003: ID 090c:1000 Silicon Motion, Inc. - Taiwan (formerly Feiya Technology Corp.) Flash Drive
Bus 002 Device 002: ID 05e3:0612 Genesys Logic, Inc. Hub
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 009: ID 067b:2303 Prolific Technology, Inc. PL2303 Serial Port
Bus 001 Device 013: ID 0000:0009
Bus 001 Device 014: ID 1c4f:0034 SiGma Micro
Bus 001 Device 011: ID 0c45:8101 Microdia
Bus 001 Device 010: ID 1a2c:2124 China Resource Semico Co., Ltd
Bus 001 Device 008: ID 05e3:0610 Genesys Logic, Inc. 4-port hub
Bus 001 Device 007: ID 0403:6001 Future Technology Devices International, Ltd FT232 Serial (UART) IC
Bus 001 Device 006: ID 05e3:0610 Genesys Logic, Inc. 4-port hub
Bus 001 Device 005: ID 16d0:0b03 MCS AIS Receiver [dAISy]
Bus 001 Device 004: ID 0bda:2838 Realtek Semiconductor Corp. RTL2838 DVB-T
Bus 001 Device 003: ID 05e3:0610 Genesys Logic, Inc. 4-port hub
Bus 001 Device 002: ID 2109:3431 VIA Labs, Inc. Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
------

lsusb command will output all devices connected to USB bus.

Run

[source, shell]
------
openplotter-serial
------

and set aliases to each serial device OpenPlotter recognizes. Aliases should be marked to
be associated with unique device IDs. See:

.Openplotter Serial Devices
image::config/openplotter-serial-devices.png[Openplotter Serial Devices, width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

After that create connections to SignalK

.Openplotter Serial Connections
image::config/openplotter-serial-connections.png[Openplotter Serial Connections, width="75%",  pdfwidth="75vw", align="center"]

=== Geolocation

BU-353S4 GPS USB mouse by default is using binary SiRF protocol. You need to switch it once to NMEA before first use.

[source, shell]
------
sudo apt install gpsd-clients
------

Do

[source, shell]
------
lsusb
------

Plug in USB mouse into raspberry pi USB port. Do lsusb again to see which new USB device appeared.
Use that device port in the command below.

[source, shell]
------
sudo stty -F /dev/ttyUSB0 4800
sudo gpsctl -n /dev/ttyUSB0
------

To obtain a fix GPS receiver needs a clear sky view. You need to have it outside. Chances are it is not going to find
a location from inside your house.

=== Charts and OpenCPN

==== Touch Screen

One of the issues that kept bugging me was the lack of multitouch support on a touchscreen
in OpenCPN and Raspbian UI in general. Well there is a fix! The solution requires the program called 'twofing'.
It is easy to install. I've combined the script for my Argonaut M7 waterproof display.

See: https://github.com/bareboat-necessities/my-bareboat/blob/master/twofing/rpi_twofing_install.sh

Now zooming works with two fingers, there is a right click emulation with two fingers touch as well.
With few modifications it can work for other screens. You will need to find out vendorID, productID and
name for your touch screen display.
I have Argonaut M7 gen2 screen. It gives me VendorID: 0000, ProductId: 0009, Name:
'Argonaut. Touchscreen'.
For Argonaut M7 gen1 I've seen in posts VendorID: 04d8, ProductId: f724
and reported device name as 'Microchip Technology, Inc.'.

Another issue with twofing and Chromium browser is that latest Chromium browser does handle multi touch
fine by itself and twofing interferes with that. To fix that you need to add "chrome" into 'profiles.h'
'blacklist' variable in twofing code. Edit 'profiles.h', recompile it and copy into /usr/bin/ :

[source, shell]
------
rm *.o twofing
make
sudo cp twofing /usr/bin/
------

One more issue is entering the text on a touchscreen. I've added virtual on screen keyboard. I've compared
several and the one I liked the most is svkbd.

I've made a script to install it.
See: https://github.com/bareboat-necessities/my-bareboat/blob/master/svkbd/rpi_svkbd_install.sh

With 'twofing' fix and an on-screen svkbd keyboard OpenCPN is much more usable on my touch screen display.
Smooth Panning/Zooming, OpenGL, and Touchscreen should be all enabled in OpenCPN settings.

The sound didn't work out of aux port. By default Raspberry Buster uses HDMI audio output and Argonaut M7 doesn't
have a speaker. This command switches it to aux (You will need to add it into linux startup scripts if you
want it on every boot):

[source, shell]
-----
amixer cset numid=3 1
-----


=== Compass / IMU / Barometer / Thermometer

Launch

[source, shell]
-----
openplotter-i2c
-----

and create sensors and connections as per screenshots below:

.Openplotter I2C Sensors
image::config/openplotter-i2c-sensors.png[Openplotter I2C Sensors, width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

.Openplotter I2C Connections
image::config/openplotter-i2c-connections.png[Openplotter I2C Connections, width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

To add compass you need to launch

[source, shell]
-----
openplotter-pypilot
-----

Create a connection like that:

.Openplotter PyPilot Connections
image::config/openplotter-pypilot-connections.png[Openplotter PyPilot Connections, width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

Check your set up

[source, shell]
-----
openplotter-startup check
-----

==== Calibration

IMU needs to be calibrated.

See: https://openplotter.readthedocs.io/en/latest/pypilot/calibration.html

In case you run into issues doing it you can start

[source, shell]
-----
pypilot_boatimu
-----

and check for errors.


=== Troubleshooting

Run

[source, shell]
-----
telnet localhost 10110
-----

to see NMEA data from SignalK. This is the stream you would need to set up as a connection in
OpenCPN.

Press Ctrl-] to get to telnet prompt anf type 'quit' and hit 'Enter' to exit from telnet session.

Sample output:

[source]
-----
Trying ::1...
Connected to localhost.
Escape character is '^]'.
$IIVTG,281.60,T,292.20,M,0.00,N,0.00,K,A*32
$IIHDG,167.67,-10.60,E,,*39
$IIHDT,157.1,T*20
$IIZDA,200813.020,20,01,2020,,*48
$IIMMB,30.2445,I,1.0242,B*78
$IIXDR,P,1.0242,B,Barometer*12
$IIHDG,167.68,-10.60,E,,*36
$IIHDM,167.7,M*25
$IIHDT,157.1,T*20
$IIXDR,A,3.2,D,PTCH,A,-91.3,D,ROLL*4B
^]
telnet> quit
-----

NOTE: You would need to calibrate your IMU sensors on your boat after mounting the computer inside the boat.
Unfortunately OpenPlotter calibration dialogs are a bit big for the resolution of your cockpit monitor.
So for calibration you might need to bring a higher resolution HDMI screen.

NOTE: When complicated issues arise (if you think it is hardware related) try to find out a chipset of the device in question and start
googling the chipset and the symptoms. Usually it gives better results than just searching by the vendor/model.

=== AIS

Setting up dAISy AIS is very straight forward. It does require higher baud rate, so make sure you specify it correctly.
After plugging into USB and antenna and registering in openplotter-serial in device mapping and connections it should
start giving AIS targets sentences via NMEA. If it doesn't see any ships close by then it doesn't send any sentences.

=== Weather

There are multiple ways to receive weather predictions:

* Download GRIB files via internet. (Only works if internet is available).

* GRIB files via SSB radio (out of scope here)

* Weather FAX (some people just connect radio to computer audio input, record audio file and covert it
using utility into image). It would be nice to completely automate this process using RTL-SDR.
+
See: https://www.rtl-sdr.com/tag/weather-fax/

* Images from NOAA satellites via radio. RTL-SDR can be used to automate this as well.
+
See: https://www.instructables.com/id/Raspberry-Pi-NOAA-Weather-Satellite-Receiver/



=== NMEA Wind Sensor

=== Testing

Another test site:

.Test Setup
image::boat-computer/boat-network-testbed.jpg[alt="Test Setup", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

.Cockpit Temporary Testbed
image::boat-computer/cockpit-temp-testbed.jpg[alt="Cockpit Temporary Testbed", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +


== Pole for Sailboat Solar Panel / Wind Generator

This is no welding, no bends solution. The pole is built from universal stainless steel marine components.
To reproduce this design you would need only a pipe cutter tool and a drill.
The top is quick release adjustable angle (two axis). Removable for winter storage.
The solar panel is quickly detachable and removable.

Most of the components are common marine rail fittings for 1" tubing. The top one component to make tee join
is aluminum drying or display rack pipe fitting tee connector for 25mm round tube
available from many vendors. It works perfectly. I use an eye nut for quick release instead of a regular nut.

https://www.amazon.com/dp/B07GZTWX85

There is also a closed body turnbuckle in the design. It needs a securing wire to be fixed in place to prevent
unscrewing.

The pipe cutter which worked perfectly easy for me on stainless steel is this one:

https://www.amazon.com/dp/B077966G15

The markings say "GT-Q50A" which points to R'DEER tool (Hong Kong brand).

[.text-center]

.Solar Panel/Wind Generator/Radar Pole Mast for Sailboat
image::solar-panel-wind-generator-radar-sailboat-pole-mast.png[alt="Solar Panel/Wind Generator/Radar Pole Mast for Sailboat", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

[.text-center]

.Solar Panel/Wind Generator/Radar Pole Mast for Sailboat View
image::solar-panel-wind-generator-radar-sailboat-pole-mast-2.jpg[alt="Solar Panel/Wind Generator/Radar Pole Mast for Sailboat View", width="75%",  pdfwidth="75vw", align="center"]

{zwsp} +

== Third-Party Projects

=== Boat Chartplotter using stick PC

https://www.youtube.com/watch?v=JYhsQSQOEbM&feature=youtu.be

Marine Chartplotter PC - Open CPN on ASUS QM1

=== Sailing with Linux (NMEA, GPSd, Iridium)

https://agile4life.blog/2018/07/16/sailing-with-linux-nmea-gpsd-iridium/

Instructions on connecting Satellite Iridium phone to Pi for satellite data services.

=== RaspEx (Ubuntu with OpenCPN)

http://raspex.exton.se/?p=1234

Another Raspberry Pi Boating Project

== Links

* https://opencpn.org/[OpenCPN]

* http://www.cruisersforum.com/forums/f134/[OpenCPN Forums]

* https://cloudsmith.io/~dan-dickey/repos/opencpn-raspbian-unstable/packages/[OpenCPN dev builds for Pi]

* http://sailoog.com/openplotter[OpenPlotter]

* https://openplotter.readthedocs.io/en/latest/[OpenPlotter Documentation]

* http://pysselilivet.blogspot.com/2019/08/openplotter-beta-v2-quick-install-guide.html[OpenPlotter 2.x beta install guide]

* http://forum.openmarine.net/[OpenPlotter Forums]

* https://www.rooco.eu/[Moitessier HAT]

* https://pypilot.org/[PyPilot]

* https://www.rtl-sdr.com/[Rtl Sdr Blog]

* http://signalk.org/[SignalK]

* http://www.stripydog.com/kplex/[KPlex]

* https://github.com/canboat[CAN Boat]

* https://squidd.io/squiddio_pi[Squidd.io as an OpenCPN plugin]

* https://github.com/sarfata?tab=repositories[KBox and other boat software]

* https://github.com/ttlappalainen?tab=repositories[NMEA2000 Libraries]

* http://openskipper.org/[OpenSkipper]

* https://marinux.tuxfamily.org/[Marinux]

* https://www.raspberrypi.org/[RaspberryPi]

* https://m5stack.com/[M5Stack]

* https://github.com/m5stack/[M5Stack on GitHub]

* https://www.openairinterface.org/[OpenAirInterface]

* https://openwrt.org/[OpenWrt]

* https://mosquitto.org/[Mosquitto MQTT Broker]

* https://nodered.org/[NodeRed]

* https://github.com/merbanan/rtl_433[IoT RTL 433]

* https://www.openscad.org/[OpenSCAD]

* https://www.nasamarine.com/product/clipper-wireless-wind/[NASA Marine Wireless Wind Instrument]

* https://rigpi.net/[RigPi]

* https://github.com/martinber/noaa-apt[NOAA APT weather satellite image decoder, for Linux, Windows, RPi 2+ and OSX]

{zwsp} +




